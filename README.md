# 黄金跨市场基差套利项目 (Hong Kong CNH Gold vs Shanghai CNY Gold Arbitrage)

## 1. 项目目标

本项目旨在探索和实现香港离岸人民币黄金（例如，通过香港交易所交易的黄金合约，以CNH计价）与上海黄金交易所的黄金主力合约（例如，AU(T+D) 或相关期货合约，以CNY计价）之间的基差套利机会。

核心策略是利用同一标的（黄金）在不同市场、不同币种计价下产生的临时价格差异，通过同时进行买入低价市场黄金、卖出高价市场黄金的操作来获取无风险或低风险利润。

## 2. 选定技术框架

经过初步调研和比较，本项目选定 **`vnpy`** 作为核心的量化交易开发和执行框架。

选择 `vnpy` 的主要原因包括：
*   **强大的多市场/多接口接入能力 (`Gateway` 机制)**：原生支持同时连接和管理来自不同交易所或经纪商的行情和交易通道，这对于跨市场套利至关重要。
*   **成熟的策略开发环境 (`CtaStrategy` 引擎)**：提供了标准化的事件驱动策略模板，便于开发、测试和管理套利逻辑。
*   **相对完善的生态系统**：拥有活跃的社区、丰富的文档资源以及多种可用的功能模块。
*   **Python 主力语言**：便于快速开发和集成。

## 3. 项目核心关注点

### 3.1. 数据源 (Data Sources)

*   **上海黄金市场**:
    *   **行情数据**: 需要接入上海黄金交易所或上海期货交易所的实时黄金合约行情 (Tick级优先)。
    *   **交易接口**: 需要通过支持程序化交易的期货公司账户接入交易，例如通过 `vnpy` 的 `CTP Gateway`。
*   **香港黄金市场**:
    *   **行情数据**: 需要接入香港相关交易所（如HKEX）的离岸人民币黄金合约（或其他适合的黄金标的）的实时行情。
    *   **交易接口**: 需要通过支持程序化交易的香港经纪商账户接入交易。调研重点包括 `vnpy` 是否有现成的 `Gateway` (如 Interactive Brokers - `IB Gateway`) 或是否需要定制开发。
*   **数据质量与同步**:
    *   确保两地行情数据的低延迟和时间戳的准确性。
    *   处理潜在的数据清洗和异常值问题。

### 3.2. 套利策略 (Arbitrage Strategy Logic)

*   **基差计算**:
    *   `基差 = 香港黄金价格(本地货币) * 汇率(如果需要转换为同一货币比较) - 上海黄金价格(本地货币)`
    *   简化版（若两地黄金价格已能直接比较或暂时忽略汇率波动）：`基差 = 香港黄金价格 - 上海黄金价格`
    *   注意合约单位、报价单位的统一。
*   **交易信号生成**:
    *   设定合理的开仓基差阈值（考虑交易成本、滑点、最小期望利润）。
    *   设定合理的平仓基差阈值（基差回归或反向扩大到一定程度）。
*   **仓位管理**:
    *   确定单次套利操作的合约手数。
    *   设置总套利组合的持仓上限。
*   **订单管理**:
    *   确保套利两腿订单的**近乎同时**发出。
    *   处理部分成交和未成交订单的逻辑。
    *   选择合适的订单类型（限价单、市价单、FOK、FAK等）以平衡成交率和滑点。

### 3.3. 执行速度 (Execution Speed)

*   **低延迟行情**: 选用速度快的行情接口，优化网络连接。
*   **快速计算**: 策略逻辑计算要高效，避免成为瓶颈。
*   **快速下单**: 交易指令的生成和发送要迅速，`Gateway` 的执行效率是关键。
*   **系统优化**: 减少 `vnpy` 内部以及自定义代码的潜在延迟。

### 3.4. 风险控制 (Risk Control)

*   **市场风险/价差风险**:
    *   基差可能不会按预期收敛，甚至反向扩大。
    *   设定止损条件（例如，最大基差亏损容忍度、持仓时间限制）。
*   **单边腿风险 (Legging Risk)**:
    *   套利一腿成交，另一腿未成交或以不利价格成交。
    *   需要有机制快速处理未平衡的敞口（如立即尝试补单或对已成交腿进行平仓）。
*   **滑点风险**:
    *   实际成交价格与下单时的价格存在不利偏差。
    *   通过合理的下单方式和流动性判断来控制。
*   **流动性风险**:
    *   某一市场或合约流动性不足，导致无法顺利建仓或平仓。
*   **交易成本**:
    *   精确计算双边手续费、印花税（如有）、资金成本等，确保套利空间能覆盖这些成本。
*   **资金管理**:
    *   设定整体策略的最大资金占用。
    *   最大可承受亏损。
*   **操作和系统风险**:
    *   程序BUG、网络中断、`Gateway` 故障等。
    *   需要有监控和应急预案。

## 4. 初步后续步骤

1.  **环境搭建**:
    *   安装 `vnpy` 及其相关依赖。
    *   配置基础的运行环境。
2.  **接口调研与配置**:
    *   详细调研并确定可用的香港黄金交易 `Gateway` 方案，并完成配置测试。
    *   配置上海黄金市场的 `CTP Gateway` (或其他适用接口)。
3.  **策略原型开发**:
    *   在 `vnpy` 的 `CtaStrategy` 模块下，开发一个基础的跨市场黄金基差套利策略原型。
    *   实现行情订阅、基差计算、简单信号触发和双边下单逻辑。
4.  **模拟测试**:
    *   连接模拟账户或进行行情回放（如果 `vnpy` 对此类跨市场回测支持良好），测试策略的基本逻辑和参数。
5.  **小规模实盘验证**:
    *   在严格风控的前提下，进行小资金规模的实盘测试，检验系统的稳定性和策略的实际表现。

## 依赖安装

### TA-Lib安装

1. 安装C库：
```bash
# 下载TA-Lib源码
wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.6.4-src.tar.gz

# 解压
tar -xzf ta-lib-0.6.4-src.tar.gz

# 编译安装
cd ta-lib-0.6.4/
./configure --prefix=/usr
make
make install

# 更新动态链接库配置
ldconfig
```

2. 安装Python包：
```bash
pip install TA-Lib
```

注意：如果安装过程中遇到问题，请确保：
- 系统已安装gcc和make工具
- 有足够的系统权限（可能需要sudo）
- Python环境正确配置

---

本文档将随着项目的进展持续更新。 