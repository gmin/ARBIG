# ARBIG é¡¹ç›®ç»“æ„è¯´æ˜

## é¡¹ç›®æ¦‚è¿°

ARBIG (Algorithmic Real-time Basis Investment Gateway) æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œä¸“æ³¨äºä¸Šæµ·æœŸè´§äº¤æ˜“æ‰€(SHFE)çš„é»„é‡‘æœŸè´§äº¤æ˜“ã€‚

## æ ¸å¿ƒæ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨**å¾®æœåŠ¡æ¶æ„**ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æœåŠ¡ï¼š

### ğŸ—ï¸ å¾®æœåŠ¡ç»„ä»¶

```
services/
â”œâ”€â”€ trading_service/        # äº¤æ˜“æœåŠ¡ (ç«¯å£: 8001)
â”‚   â”œâ”€â”€ main.py            # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ trading.py     # äº¤æ˜“æ“ä½œAPI
â”‚   â”‚   â”œâ”€â”€ market_data.py # è¡Œæƒ…æ•°æ®API
â”‚   â”‚   â”œâ”€â”€ real_trading.py # çœŸå®äº¤æ˜“API
â”‚   â”‚   â””â”€â”€ logs.py        # äº¤æ˜“æ—¥å¿—API
â”‚   â””â”€â”€ core/              # æ ¸å¿ƒåŠŸèƒ½
â”‚       â”œâ”€â”€ ctp_integration.py    # CTPé›†æˆ
â”‚       â”œâ”€â”€ market_data_manager.py # è¡Œæƒ…ç®¡ç†
â”‚       â””â”€â”€ unified_strategy_manager.py # ç»Ÿä¸€ç­–ç•¥ç®¡ç†
â”‚
â”œâ”€â”€ strategy_service/       # ç­–ç•¥æœåŠ¡ (ç«¯å£: 8002)
â”‚   â”œâ”€â”€ main.py            # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ core/              # ç­–ç•¥å¼•æ“æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ strategy_engine.py    # ç­–ç•¥æ‰§è¡Œå¼•æ“
â”‚   â”‚   â”œâ”€â”€ cta_template.py       # vnpyé£æ ¼ç­–ç•¥åŸºç±»
â”‚   â”‚   â”œâ”€â”€ data_tools.py         # æ•°æ®å·¥å…·(Kçº¿ç”Ÿæˆã€æŠ€æœ¯æŒ‡æ ‡)
â”‚   â”‚   â”œâ”€â”€ signal_sender.py      # ä¿¡å·å‘é€å™¨
â”‚   â”‚   â””â”€â”€ framework/            # ç­–ç•¥æ¡†æ¶ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ decision_engine.py   # å†³ç­–å¼•æ“
â”‚   â”‚       â””â”€â”€ signal_generator.py  # ä¿¡å·ç”Ÿæˆå™¨
â”‚   â””â”€â”€ strategies/        # ç­–ç•¥å®ç°
â”‚       â”œâ”€â”€ test_strategy.py          # æµ‹è¯•ç­–ç•¥
â”‚       â”œâ”€â”€ double_ma_strategy.py     # åŒå‡çº¿ç­–ç•¥
â”‚       â”œâ”€â”€ simple_shfe_strategy.py   # ç®€åŒ–SHFEç­–ç•¥
â”‚       â”œâ”€â”€ shfe_quant_strategy.py    # é‡åŒ–ç­–ç•¥
â”‚       â””â”€â”€ advanced_shfe_strategy.py # é«˜çº§ç­–ç•¥(ä½¿ç”¨æ¡†æ¶ç»„ä»¶)
â”‚
â””â”€â”€ web_admin_service/      # Webç®¡ç†æœåŠ¡ (ç«¯å£: 80)
    â”œâ”€â”€ main.py            # æœåŠ¡å…¥å£
    â”œâ”€â”€ api/               # APIä»£ç†
    â”‚   â””â”€â”€ trading.py     # äº¤æ˜“APIä»£ç†
    â”œâ”€â”€ static/            # é™æ€èµ„æº
    â”‚   â”œâ”€â”€ js/           # JavaScriptæ–‡ä»¶
    â”‚   â””â”€â”€ css/          # æ ·å¼æ–‡ä»¶
    â””â”€â”€ templates/         # HTMLæ¨¡æ¿
        â”œâ”€â”€ index.html     # ä¸»é¡µé¢
        â”œâ”€â”€ trading.html   # äº¤æ˜“ç®¡ç†é¡µé¢
        â””â”€â”€ strategy.html  # ç­–ç•¥ç®¡ç†é¡µé¢
```

### ğŸ§  æ ¸å¿ƒæ¨¡å—

```
core/
â”œâ”€â”€ config_manager.py      # é…ç½®ç®¡ç†
â”œâ”€â”€ constants.py           # å¸¸é‡å®šä¹‰
â”œâ”€â”€ event_bus.py           # äº‹ä»¶æ€»çº¿
â”œâ”€â”€ event_engine.py        # äº‹ä»¶å¼•æ“
â”œâ”€â”€ position_manager.py    # æŒä»“ç®¡ç†
â”œâ”€â”€ risk.py               # é£é™©ç®¡ç†
â”œâ”€â”€ types.py              # æ•°æ®ç±»å‹å®šä¹‰
â”œâ”€â”€ services_archive/     # å·²æ¸…ç†çš„æ—§æœåŠ¡ä»£ç 
â””â”€â”€ legacy_archive/       # å·²æ¸…ç†çš„é—ç•™ä»£ç 
```

### ğŸ› ï¸ æ”¯æ’‘æ¨¡å—

```
shared/                   # å…±äº«æ¨¡å—
â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”œâ”€â”€ utils/               # å·¥å…·ç±»
â””â”€â”€ database/            # æ•°æ®åº“ç›¸å…³

utils/                   # å·¥å…·å‡½æ•°
â”œâ”€â”€ logger.py           # æ—¥å¿—å·¥å…·
â””â”€â”€ [å…¶ä»–å·¥å…·]

config/                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.py           # ä¸»é…ç½®
â”œâ”€â”€ ctp_sim.json        # CTPä»¿çœŸé…ç½®
â”œâ”€â”€ database.json       # æ•°æ®åº“é…ç½®
â””â”€â”€ strategies.json     # ç­–ç•¥é…ç½®

gateways/               # äº¤æ˜“ç½‘å…³
â””â”€â”€ ctp_gateway.py      # CTPç½‘å…³å®ç°
```

## ğŸ“š æ–‡æ¡£ç»“æ„

```
docs/
â”œâ”€â”€ README.md                    # æ–‡æ¡£æ€»è§ˆ
â”œâ”€â”€ CURRENT_ARCHITECTURE.md     # å½“å‰æ¶æ„è¯´æ˜
â”œâ”€â”€ USER_MANUAL.md              # ç”¨æˆ·æ‰‹å†Œ
â”œâ”€â”€ WEB_UI_DESIGN.md            # Webç•Œé¢è®¾è®¡
â”œâ”€â”€ DEPLOYMENT_GUIDE.md         # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ API_REFERENCE.md            # APIå‚è€ƒ
â”œâ”€â”€ position_management.md      # æŒä»“ç®¡ç†è¯´æ˜
â”œâ”€â”€ technical/                  # æŠ€æœ¯æ–‡æ¡£
â”‚   â”œâ”€â”€ DATABASE_CONNECTION_SUMMARY.md
â”‚   â”œâ”€â”€ DATABASE_INFO.md
â”‚   â””â”€â”€ DATA_INFRASTRUCTURE_SUMMARY.md
â”œâ”€â”€ maintenance/                # ç»´æŠ¤æ–‡æ¡£
â”‚   â”œâ”€â”€ CORE_CLEANUP_SUMMARY.md
â”‚   â”œâ”€â”€ STRATEGY_MIGRATION_SUMMARY.md
â”‚   â””â”€â”€ [å…¶ä»–ç»´æŠ¤è®°å½•]
â”œâ”€â”€ strategies/                 # ç­–ç•¥æ–‡æ¡£
â””â”€â”€ archive/                    # å†å²æ–‡æ¡£
    â””â”€â”€ [å·²è¿‡æ—¶çš„æ–‡æ¡£]
```

## ğŸš€ å¯åŠ¨æ–¹å¼

### å¼€å‘ç¯å¢ƒå¯åŠ¨
```bash
# æ–¹å¼1: å¸¦æ—¥å¿—çš„å¯åŠ¨è„šæœ¬
./start_with_logs.py

# æ–¹å¼2: åŸºç¡€å¯åŠ¨è„šæœ¬
python start.py

# æ–¹å¼3: æ‰‹åŠ¨å¯åŠ¨å„æœåŠ¡
cd services/trading_service && conda run -n vnpy uvicorn main:app --host 0.0.0.0 --port 8001
cd services/strategy_service && conda run -n vnpy uvicorn main:app --host 0.0.0.0 --port 8002
cd services/web_admin_service && python main.py
```

### è®¿é—®åœ°å€
- **Webç®¡ç†ç•Œé¢**: http://localhost/
- **äº¤æ˜“æœåŠ¡API**: http://localhost:8001/docs
- **ç­–ç•¥æœåŠ¡API**: http://localhost:8002/docs

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. äº¤æ˜“ç®¡ç†
- å®æ—¶è¡Œæƒ…æ•°æ®æ¥æ”¶å’Œå¤„ç†
- è®¢å•ç®¡ç†å’Œæ‰§è¡Œ
- æŒä»“ç®¡ç†(ä»Šä»“/æ˜¨ä»“åˆ†ç¦»)
- æ™ºèƒ½å¹³ä»“ç³»ç»Ÿ

### 2. ç­–ç•¥ç³»ç»Ÿ
- vnpyé£æ ¼çš„ç­–ç•¥å¼€å‘æ¡†æ¶
- å¤šç§å†…ç½®ç­–ç•¥æ¨¡æ¿
- åŠ¨æ€ç­–ç•¥åŠ è½½å’Œç®¡ç†
- ç­–ç•¥å‚æ•°å®æ—¶è°ƒæ•´

### 3. Webç®¡ç†ç•Œé¢
- ç›´è§‚çš„äº¤æ˜“ç›‘æ§é¢æ¿
- ç­–ç•¥ç®¡ç†å’Œç›‘æ§
- å®æ—¶æ•°æ®å±•ç¤º
- æ“ä½œæ—¥å¿—æŸ¥çœ‹

### 4. é£é™©æ§åˆ¶
- å®æ—¶é£é™©ç›‘æ§
- æŒä»“é™åˆ¶ç®¡ç†
- æ­¢æŸæ­¢ç›ˆæ§åˆ¶

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: Python, FastAPI, vnpy
- **å‰ç«¯**: HTML5, CSS3, JavaScript (ES6+)
- **æ•°æ®åº“**: SQLite, Redis (å¯é€‰)
- **äº¤æ˜“æ¥å£**: CTP (Comprehensive Trading Platform)
- **éƒ¨ç½²**: Docker (å¯é€‰), ç³»ç»ŸæœåŠ¡

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç­–ç•¥
1. åœ¨ `services/strategy_service/strategies/` åˆ›å»ºç­–ç•¥æ–‡ä»¶
2. ç»§æ‰¿ `ARBIGCtaTemplate` åŸºç±»
3. å®ç°å¿…è¦çš„å›è°ƒæ–¹æ³•
4. å®šä¹‰ç­–ç•¥å‚æ•°æ¨¡æ¿
5. é€šè¿‡Webç•Œé¢æˆ–APIæ³¨å†Œç­–ç•¥

### æ‰©å±•API
1. åœ¨å¯¹åº”æœåŠ¡çš„ `api/` ç›®å½•æ·»åŠ è·¯ç”±æ–‡ä»¶
2. åœ¨ `main.py` ä¸­æ³¨å†Œæ–°çš„è·¯ç”±
3. æ›´æ–°APIæ–‡æ¡£

### ä¿®æ”¹é…ç½®
- ä¸»é…ç½®: `config/config.py`
- CTPé…ç½®: `config/ctp_sim.json`
- ç­–ç•¥é…ç½®: `config/strategies.json`

## ğŸ·ï¸ ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: 2.0.0
- **æ¶æ„**: å¾®æœåŠ¡
- **æœ€åæ›´æ–°**: 2025-08-17
- **ç»´æŠ¤çŠ¶æ€**: æ´»è·ƒå¼€å‘ä¸­

---

*æœ¬æ–‡æ¡£ä¼šéšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒå…·ä½“æ¨¡å—çš„æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚*
