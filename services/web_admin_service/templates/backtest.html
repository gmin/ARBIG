<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›æµ‹åˆ†æ - ARBIGé‡åŒ–äº¤æ˜“ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        .backtest-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        
        .backtest-card:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.15);
        }
        
        .backtest-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            margin-bottom: 4px;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .result-card {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .result-title {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .result-time {
            font-size: 12px;
            color: #6c757d;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }
        
        .metric-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .metric-value.positive {
            color: #28a745;
        }
        
        .metric-value.negative {
            color: #dc3545;
        }
        
        .metric-label {
            font-size: 11px;
            color: #6c757d;
            text-transform: uppercase;
        }
        
        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-style: italic;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #007bff;
        }
        
        .error-state {
            text-align: center;
            color: #dc3545;
            padding: 20px;
            background: #f8d7da;
            border-radius: 4px;
            margin: 12px 0;
        }
        
        .success-state {
            text-align: center;
            color: #155724;
            padding: 20px;
            background: #d4edda;
            border-radius: 4px;
            margin: 12px 0;
        }
        
        .tab-container {
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 20px;
        }
        
        .tab-nav {
            display: flex;
            gap: 0;
        }
        
        .tab-button {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/" class="navbar-brand">ğŸ“Š ARBIGé‡åŒ–äº¤æ˜“ç³»ç»Ÿ</a>
            <div class="navbar-center">
                <ul class="navbar-nav">
                    <li><a href="/">æ§åˆ¶å°</a></li>
                    <li><a href="/trading">äº¤æ˜“ç®¡ç†</a></li>
                    <li><a href="/strategy">ç­–ç•¥ç®¡ç†</a></li>
                    <li><a href="/backtest" class="active">å›æµ‹åˆ†æ</a></li>
                    <li><a href="/api/docs" target="_blank">APIæ–‡æ¡£</a></li>
                </ul>
            </div>
            <div class="navbar-user">
                <div class="user-info">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <div class="user-name">äº¤æ˜“å‘˜</div>
                        <div class="user-status">åœ¨çº¿</div>
                    </div>
                </div>
                <div class="user-menu">
                    <button class="btn btn-outline" onclick="logout()">é€€å‡º</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">å›æµ‹åˆ†æ</h1>
            <div class="page-subtitle">ç­–ç•¥å†å²éªŒè¯ã€å‚æ•°ä¼˜åŒ–ä¸æ€§èƒ½åˆ†æ</div>
        </div>

        <!-- æœåŠ¡çŠ¶æ€ -->
        <div class="grid grid-4" style="margin-top: 32px;">
            <div class="card stat-card">
                <div class="stat-value" id="service-status">æ£€æŸ¥ä¸­...</div>
                <div class="stat-label">å›æµ‹æœåŠ¡çŠ¶æ€</div>
            </div>
            <div class="card stat-card">
                <div class="stat-value" id="available-strategies">0</div>
                <div class="stat-label">å¯ç”¨ç­–ç•¥æ•°é‡</div>
            </div>
            <div class="card stat-card">
                <div class="stat-value" id="total-results">0</div>
                <div class="stat-label">å†å²å›æµ‹æ¬¡æ•°</div>
            </div>
            <div class="card stat-card">
                <div class="stat-value">
                    <button id="refresh-btn" class="btn btn-primary btn-sm">ğŸ”„ åˆ·æ–°</button>
                    <button id="clear-results-btn" class="btn btn-outline btn-sm" style="margin-left: 8px;">ğŸ—‘ï¸ æ¸…ç†</button>
                </div>
                <div class="stat-label">æ“ä½œ</div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tab-container" style="margin-top: 32px;">
            <div class="tab-nav">
                <button class="tab-button active" onclick="switchTab('quick-backtest')">âš¡ å¿«é€Ÿå›æµ‹</button>
                <button class="tab-button" onclick="switchTab('advanced-backtest')">ğŸ”§ é«˜çº§å›æµ‹</button>
                <button class="tab-button" onclick="switchTab('batch-backtest')">ğŸ“Š æ‰¹é‡å›æµ‹</button>
                <button class="tab-button" onclick="switchTab('results')">ğŸ“ˆ å›æµ‹ç»“æœ</button>
            </div>
        </div>

        <!-- å¿«é€Ÿå›æµ‹æ ‡ç­¾é¡µ -->
        <div id="quick-backtest" class="tab-content active">
            <div class="card">
                <div class="card-header">âš¡ å¿«é€Ÿå›æµ‹ - ä½¿ç”¨æœ€è¿‘7å¤©æ•°æ®</div>
                <div class="card-body">
                    <div class="backtest-form">
                        <div class="form-group">
                            <label for="quick-strategy">é€‰æ‹©ç­–ç•¥</label>
                            <select id="quick-strategy">
                                <option value="">è¯·é€‰æ‹©ç­–ç•¥...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="quick-days">å›æµ‹å¤©æ•°</label>
                            <select id="quick-days">
                                <option value="3">3å¤©</option>
                                <option value="7" selected>7å¤©</option>
                                <option value="15">15å¤©</option>
                                <option value="30">30å¤©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="quick-position">æœ€å¤§æŒä»“</label>
                            <input type="number" id="quick-position" value="5" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button id="run-quick-backtest" class="btn btn-primary">ğŸš€ å¼€å§‹å¿«é€Ÿå›æµ‹</button>
                        </div>
                    </div>
                    <div id="quick-result" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>

        <!-- é«˜çº§å›æµ‹æ ‡ç­¾é¡µ -->
        <div id="advanced-backtest" class="tab-content">
            <div class="card">
                <div class="card-header">ğŸ”§ é«˜çº§å›æµ‹ - è‡ªå®šä¹‰å‚æ•°å’Œæ—¶é—´èŒƒå›´</div>
                <div class="card-body">
                    <div class="empty-state">
                        <h4>ğŸ”§ é«˜çº§å›æµ‹åŠŸèƒ½</h4>
                        <p>æä¾›å®Œæ•´çš„å›æµ‹å‚æ•°é…ç½®å’Œæ—¶é—´èŒƒå›´é€‰æ‹©</p>
                        <p><strong>åŠŸèƒ½ç‰¹ç‚¹ï¼š</strong></p>
                        <ul style="text-align: left; margin: 16px 0;">
                            <li>è‡ªå®šä¹‰å›æµ‹æ—¶é—´èŒƒå›´</li>
                            <li>çµæ´»çš„å‚æ•°é…ç½®</li>
                            <li>è¯¦ç»†çš„æ€§èƒ½åˆ†æ</li>
                            <li>é£é™©æŒ‡æ ‡è®¡ç®—</li>
                        </ul>
                        <div style="margin-top: 16px;">
                            <button class="btn btn-primary" onclick="window.open('http://localhost:8003/docs', '_blank')">ğŸ“– æŸ¥çœ‹APIæ–‡æ¡£</button>
                            <button class="btn btn-outline" onclick="window.open('http://localhost:8003/redoc', '_blank')" style="margin-left: 8px;">ğŸ“‹ æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡å›æµ‹æ ‡ç­¾é¡µ -->
        <div id="batch-backtest" class="tab-content">
            <div class="card">
                <div class="card-header">ğŸ“Š æ‰¹é‡å›æµ‹ - å¤šç­–ç•¥å¯¹æ¯”åˆ†æ</div>
                <div class="card-body">
                    <div class="empty-state">
                        <h4>ğŸ“Š æ‰¹é‡å›æµ‹åŠŸèƒ½</h4>
                        <p>åŒæ—¶å›æµ‹å¤šä¸ªç­–ç•¥ï¼Œè¿›è¡Œæ€§èƒ½å¯¹æ¯”åˆ†æ</p>
                        <p><strong>åŠŸèƒ½ç‰¹ç‚¹ï¼š</strong></p>
                        <ul style="text-align: left; margin: 16px 0;">
                            <li>å¤šç­–ç•¥å¹¶è¡Œå›æµ‹</li>
                            <li>æ€§èƒ½å¯¹æ¯”åˆ†æ</li>
                            <li>ç­–ç•¥æ’åç»Ÿè®¡</li>
                            <li>ç»¼åˆè¯„ä¼°æŠ¥å‘Š</li>
                        </ul>
                        <div style="margin-top: 16px;">
                            <button class="btn btn-primary" onclick="window.open('http://localhost:8003/docs', '_blank')">ğŸ“– æŸ¥çœ‹APIæ–‡æ¡£</button>
                            <button class="btn btn-outline" onclick="loadBacktestResults()" style="margin-left: 8px;">ğŸ“Š æŸ¥çœ‹å†å²ç»“æœ</button>
                        </div>
                        <div style="margin-top: 16px;">
                            <button class="btn btn-primary" onclick="window.open('http://localhost:8003/docs', '_blank')">ğŸ“– æŸ¥çœ‹APIæ–‡æ¡£</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å›æµ‹ç»“æœæ ‡ç­¾é¡µ -->
        <div id="results" class="tab-content">
            <div class="card">
                <div class="card-header">ğŸ“ˆ å†å²å›æµ‹ç»“æœ</div>
                <div class="card-body">
                    <div id="results-list">
                        <div class="loading">æ­£åœ¨åŠ è½½å›æµ‹ç»“æœ...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let availableStrategies = [];
        let backtestResults = [];

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeçŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');

            // å¦‚æœåˆ‡æ¢åˆ°ç»“æœé¡µé¢ï¼ŒåŠ è½½ç»“æœ
            if (tabId === 'results') {
                loadBacktestResults();
            }
        }

        // åŠ è½½å¯ç”¨ç­–ç•¥
        async function loadAvailableStrategies() {
            try {
                console.log('ğŸ” åŠ è½½å¯ç”¨ç­–ç•¥...');
                const response = await fetch('http://localhost:8003/backtest/strategies');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('ğŸ“Š ç­–ç•¥åˆ—è¡¨å“åº”:', result);

                if (result.success && result.data && result.data.strategies) {
                    availableStrategies = result.data.strategies;

                    // æ›´æ–°ç­–ç•¥æ•°é‡
                    document.getElementById('available-strategies').textContent = availableStrategies.length;

                    // å¡«å……ç­–ç•¥é€‰æ‹©æ¡†
                    const strategySelect = document.getElementById('quick-strategy');
                    strategySelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç­–ç•¥...</option>';

                    availableStrategies.forEach(strategy => {
                        const option = document.createElement('option');
                        option.value = strategy;
                        option.textContent = strategy;
                        strategySelect.appendChild(option);
                    });

                    console.log('âœ… ç­–ç•¥åˆ—è¡¨åŠ è½½å®Œæˆ:', availableStrategies.length, 'ä¸ªç­–ç•¥');
                } else {
                    throw new Error('ç­–ç•¥åˆ—è¡¨æ•°æ®æ ¼å¼é”™è¯¯');
                }

            } catch (error) {
                console.error('âŒ åŠ è½½ç­–ç•¥åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('available-strategies').textContent = '0';
                document.getElementById('service-status').textContent = 'æœåŠ¡å¼‚å¸¸';
                document.getElementById('service-status').style.color = '#dc3545';
            }
        }

        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        async function checkServiceStatus() {
            try {
                const response = await fetch('http://localhost:8003/health');

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('service-status').textContent = 'æ­£å¸¸è¿è¡Œ';
                    document.getElementById('service-status').style.color = '#28a745';
                    console.log('âœ… å›æµ‹æœåŠ¡çŠ¶æ€æ­£å¸¸');
                } else {
                    throw new Error('æœåŠ¡å“åº”å¼‚å¸¸');
                }

            } catch (error) {
                console.error('âŒ å›æµ‹æœåŠ¡æ£€æŸ¥å¤±è´¥:', error);
                document.getElementById('service-status').textContent = 'æœåŠ¡å¼‚å¸¸';
                document.getElementById('service-status').style.color = '#dc3545';
            }
        }

        // è¿è¡Œå¿«é€Ÿå›æµ‹
        async function runQuickBacktest() {
            const strategyName = document.getElementById('quick-strategy').value;
            const days = parseInt(document.getElementById('quick-days').value);
            const maxPosition = parseInt(document.getElementById('quick-position').value);

            if (!strategyName) {
                alert('è¯·é€‰æ‹©è¦å›æµ‹çš„ç­–ç•¥');
                return;
            }

            const resultDiv = document.getElementById('quick-result');
            const runButton = document.getElementById('run-quick-backtest');

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                runButton.textContent = 'å›æµ‹ä¸­...';
                runButton.disabled = true;
                resultDiv.innerHTML = '<div class="loading">æ­£åœ¨è¿è¡Œå›æµ‹ï¼Œè¯·ç¨å€™...</div>';

                console.log('ğŸš€ å¼€å§‹å¿«é€Ÿå›æµ‹:', strategyName, days, 'å¤©');

                const response = await fetch('http://localhost:8003/backtest/quick', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        strategy_name: strategyName,
                        strategy_setting: {
                            max_position: maxPosition
                        },
                        days: days
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('ğŸ“Š å¿«é€Ÿå›æµ‹ç»“æœ:', result);

                if (result.success && result.data) {
                    displayQuickBacktestResult(result.data);
                    // æ›´æ–°ç»“æœè®¡æ•°
                    loadBacktestResults();
                } else {
                    throw new Error(result.message || 'å›æµ‹å¤±è´¥');
                }

            } catch (error) {
                console.error('âŒ å¿«é€Ÿå›æµ‹å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div class="error-state">
                        <h4>âš ï¸ å›æµ‹åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨</h4>
                        <p>å¿«é€Ÿå›æµ‹åŠŸèƒ½æ­£åœ¨ç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•ã€‚</p>
                        <p><strong>é”™è¯¯è¯¦æƒ…ï¼š</strong>${error.message}</p>
                        <div style="margin-top: 16px;">
                            <button class="btn btn-outline btn-sm" onclick="window.open('http://localhost:8003/docs', '_blank')">ğŸ“– æŸ¥çœ‹APIæ–‡æ¡£</button>
                            <button class="btn btn-primary btn-sm" onclick="loadBacktestResults()" style="margin-left: 8px;">ğŸ“Š æŸ¥çœ‹å†å²ç»“æœ</button>
                        </div>
                    </div>
                `;
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                runButton.textContent = 'ğŸš€ å¼€å§‹å¿«é€Ÿå›æµ‹';
                runButton.disabled = false;
            }
        }

        // æ˜¾ç¤ºå¿«é€Ÿå›æµ‹ç»“æœ
        function displayQuickBacktestResult(data) {
            const resultDiv = document.getElementById('quick-result');

            // æå–å…³é”®æŒ‡æ ‡
            const metrics = data.basic_result || data.result || data;
            const totalReturn = (metrics.total_return || 0) * 100;
            const sharpeRatio = metrics.sharpe_ratio || 0;
            const maxDrawdown = (metrics.max_drawdown || 0) * 100;
            const winRate = (metrics.win_rate || 0) * 100;

            resultDiv.innerHTML = `
                <div class="success-state">
                    <h4>âœ… å›æµ‹å®Œæˆ</h4>
                    <p>ç­–ç•¥: ${data.strategy_name || 'æœªçŸ¥'} | æ—¶é—´: ${new Date().toLocaleString()}</p>
                </div>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value ${totalReturn >= 0 ? 'positive' : 'negative'}">${totalReturn.toFixed(2)}%</div>
                        <div class="metric-label">æ€»æ”¶ç›Šç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${sharpeRatio.toFixed(2)}</div>
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value ${maxDrawdown <= 0 ? 'negative' : ''}">${maxDrawdown.toFixed(2)}%</div>
                        <div class="metric-label">æœ€å¤§å›æ’¤</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${winRate.toFixed(1)}%</div>
                        <div class="metric-label">èƒœç‡</div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½å›æµ‹ç»“æœ
        async function loadBacktestResults() {
            const resultsDiv = document.getElementById('results-list');

            try {
                resultsDiv.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½å›æµ‹ç»“æœ...</div>';

                const response = await fetch('http://localhost:8003/backtest/results');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('ğŸ“Š å›æµ‹ç»“æœå“åº”:', result);

                if (result.success && result.data) {
                    let resultsArray = [];

                    if (Array.isArray(result.data)) {
                        resultsArray = result.data;
                    } else if (result.data.results) {
                        resultsArray = Object.entries(result.data.results).map(([key, value]) => ({
                            result_key: key,
                            ...value
                        }));
                    }

                    // æ›´æ–°ç»“æœè®¡æ•°
                    document.getElementById('total-results').textContent = resultsArray.length;

                    if (resultsArray.length === 0) {
                        resultsDiv.innerHTML = `
                            <div class="empty-state">
                                <h4>ğŸ’¡ æš‚æ— å›æµ‹ç»“æœ</h4>
                                <p>è¿˜æ²¡æœ‰è¿›è¡Œè¿‡å›æµ‹ï¼Œè¯·ä½¿ç”¨å¿«é€Ÿå›æµ‹åŠŸèƒ½å¼€å§‹ã€‚</p>
                            </div>
                        `;
                    } else {
                        displayBacktestResults(resultsArray);
                    }
                } else {
                    throw new Error('å›æµ‹ç»“æœæ•°æ®æ ¼å¼é”™è¯¯');
                }

            } catch (error) {
                console.error('âŒ åŠ è½½å›æµ‹ç»“æœå¤±è´¥:', error);
                resultsDiv.innerHTML = `<div class="error-state">åŠ è½½å›æµ‹ç»“æœå¤±è´¥: ${error.message}</div>`;
                document.getElementById('total-results').textContent = '0';
            }
        }

        // æ˜¾ç¤ºå›æµ‹ç»“æœåˆ—è¡¨
        function displayBacktestResults(results) {
            const resultsDiv = document.getElementById('results-list');

            const resultsHtml = results.map(result => {
                const metrics = result.basic_result || result.result || result;
                const totalReturn = (metrics.total_return || 0) * 100;
                const strategyName = result.strategy_name || result.result_key?.split('_')[0] || 'æœªçŸ¥ç­–ç•¥';
                const timestamp = result.timestamp ? new Date(result.timestamp).toLocaleString() : 'æœªçŸ¥æ—¶é—´';

                return `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">${strategyName}</div>
                            <div class="result-time">${timestamp}</div>
                        </div>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-value ${totalReturn >= 0 ? 'positive' : 'negative'}">${totalReturn.toFixed(2)}%</div>
                                <div class="metric-label">æ”¶ç›Šç‡</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${(metrics.sharpe_ratio || 0).toFixed(2)}</div>
                                <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${((metrics.max_drawdown || 0) * 100).toFixed(2)}%</div>
                                <div class="metric-label">æœ€å¤§å›æ’¤</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${((metrics.win_rate || 0) * 100).toFixed(1)}%</div>
                                <div class="metric-label">èƒœç‡</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            resultsDiv.innerHTML = resultsHtml;
        }

        // é€šç”¨å·¥å…·å‡½æ•°
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ')) {
                window.location.href = '/';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ å›æµ‹åˆ†æé¡µé¢åˆå§‹åŒ–');

            // ç»‘å®šäº‹ä»¶
            document.getElementById('run-quick-backtest').addEventListener('click', runQuickBacktest);
            document.getElementById('refresh-btn').addEventListener('click', function() {
                console.log('ğŸ”„ åˆ·æ–°å›æµ‹æ•°æ®');
                checkServiceStatus();
                loadAvailableStrategies();
                loadBacktestResults();
            });

            // åˆå§‹åŒ–åŠ è½½
            checkServiceStatus();
            loadAvailableStrategies();
        });
    </script>
</body>
</html>
