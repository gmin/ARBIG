<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®ç›˜äº¤æ˜“ç»Ÿè®¡ - ARBIGé‡åŒ–äº¤æ˜“ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
    <style>
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .stat-card.positive {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }
        .stat-card.negative {
            background: linear-gradient(135deg, #f44336 0%, #da190b 100%);
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .strategy-row {
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .strategy-row:hover {
            background-color: #f8f9fa;
        }
        .status-badge {
            font-size: 0.8em;
        }
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        /* é¡µé¢å†…å¯¼èˆªæ ·å¼ */
        .page-nav {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-buttons .btn {
            margin-right: 10px;
            margin-bottom: 5px;
        }

        .nav-buttons .btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* è¡¨æ ¼æ ·å¼è°ƒæ•´ */
        .table {
            background: white;
        }

        .table th {
            background-color: #f8f9fa;
            border-top: none;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/" class="navbar-brand">ğŸ“Š ARBIGé‡åŒ–äº¤æ˜“ç³»ç»Ÿ</a>
            <div class="navbar-center">
                <ul class="navbar-nav">
                    <li><a href="/">æ§åˆ¶å°</a></li>
                    <li><a href="/trading">äº¤æ˜“ç®¡ç†</a></li>
                    <li><a href="/strategy">ç­–ç•¥ç®¡ç†</a></li>
                    <li><a href="/trading_statistics" class="active">äº¤æ˜“ç»Ÿè®¡</a></li>
                    <li><a href="/api/docs" target="_blank">APIæ–‡æ¡£</a></li>
                </ul>
            </div>
            <div class="navbar-user">
                <div class="user-info">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <div class="user-name">äº¤æ˜“å‘˜</div>
                        <div class="user-status">åœ¨çº¿</div>
                    </div>
                </div>
                <div class="user-menu">
                    <button class="btn btn-outline" onclick="logout()">é€€å‡º</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">å®ç›˜äº¤æ˜“ç»Ÿè®¡</h1>
            <p class="page-subtitle">å®æ—¶ç›‘æ§ç­–ç•¥äº¤æ˜“è¡¨ç°å’Œä¿¡å·åˆ†æ</p>
        </div>

        <!-- é¡µé¢å†…å¯¼èˆª -->
        <div class="page-nav">
            <div class="nav-buttons">
                <button type="button" class="btn btn-outline" onclick="scrollToSection('overview')">
                    ğŸ“Š æ€»è§ˆ
                </button>
                <button type="button" class="btn btn-outline" onclick="scrollToSection('charts')">
                    ğŸ“ˆ å›¾è¡¨
                </button>
                <button type="button" class="btn btn-outline" onclick="scrollToSection('signals')">
                    ğŸ¯ ä¿¡å·åˆ†æ
                </button>
                <button type="button" class="btn btn-outline" onclick="scrollToSection('ranking')">
                    ğŸ† ç­–ç•¥æ’å
                </button>
                <button type="button" class="btn btn-outline" onclick="scrollToSection('realtime')">
                    ğŸ“¡ å®æ—¶çŠ¶æ€
                </button>
                <div style="float: right;">
                    <button class="btn btn-primary" onclick="refreshData()">
                        ğŸ”„ åˆ·æ–°æ•°æ®
                    </button>
                    <button class="btn btn-outline" onclick="exportData()">
                        ğŸ“¥ å¯¼å‡ºæ•°æ®
                    </button>
                </div>
            </div>
        </div>

        <!-- æ€»è§ˆç»Ÿè®¡å¡ç‰‡ -->
        <div class="grid grid-4" id="overview-cards" data-section="overview">
            <div class="card stat-card">
                <div class="stat-value" id="total-strategies">
                    <span class="stat-number">-</span>
                    <span class="stat-label">æ€»ç­–ç•¥æ•°</span>
                </div>
                <div class="stat-info">
                    <span class="stat-change">æ´»è·ƒ: <span id="active-strategies">-</span></span>
                </div>
            </div>
            <div class="card stat-card" id="pnl-card">
                <div class="stat-value" id="total-pnl-display">
                    <span class="stat-number" id="total-pnl">-</span>
                    <span class="stat-label">æ€»ç›ˆäº</span>
                </div>
                <div class="stat-info">
                    <span class="stat-change">å‡€ç›ˆäº: <span id="net-pnl">-</span></span>
                </div>
            </div>
            <div class="card stat-card">
                <div class="stat-value" id="total-trades-display">
                    <span class="stat-number" id="total-trades">-</span>
                    <span class="stat-label">æ€»äº¤æ˜“æ•°</span>
                </div>
                <div class="stat-info">
                    <span class="stat-change">èƒœç‡: <span id="win-rate">-</span>%</span>
                </div>
            </div>
            <div class="card stat-card">
                <div class="stat-value" id="winning-strategies-display">
                    <span class="stat-number" id="winning-strategies">-</span>
                    <span class="stat-label">ç›ˆåˆ©ç­–ç•¥</span>
                </div>
                <div class="stat-info">
                    <span class="stat-change">å æ¯”: <span id="winning-ratio">-</span>%</span>
                </div>
            </div>
        </div>

        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="grid grid-2" id="charts" data-section="charts">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“ˆ å‡€å€¼æ›²çº¿</h3>
                </div>
                <div class="card-content">
                    <canvas id="equityChart" height="300"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ¥§ ç­–ç•¥ç›ˆäºåˆ†å¸ƒ</h3>
                </div>
                <div class="card-content">
                    <canvas id="pnlChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- ä¿¡å·åˆ†æåŒºåŸŸ -->
        <div class="grid grid-2" id="signals" data-section="signals">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ¯ ä¿¡å·è§¦å‘åˆ†æ</h3>
                </div>
                <div class="card-content">
                    <canvas id="signalChart" height="200"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>â° ä¿¡å·é¢‘ç‡åˆ†å¸ƒ</h3>
                </div>
                <div class="card-content">
                    <canvas id="frequencyChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- ç­–ç•¥æ’åè¡¨æ ¼ -->
        <div class="card" id="ranking" data-section="ranking">
            <div class="card-header">
                <h3>ğŸ† ç­–ç•¥æ€§èƒ½æ’å</h3>
            </div>
            <div class="card-content">
                <div class="table-responsive">
                    <table class="table">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>ç­–ç•¥åç§°</th>
                                    <th>å‡€ç›ˆäº</th>
                                    <th>èƒœç‡</th>
                                    <th>äº¤æ˜“æ•°</th>
                                    <th>ä¿¡å·æ•°</th>
                                    <th>æœ€å¤§å›æ’¤</th>
                                    <th>å¤æ™®æ¯”ç‡</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="strategy-ranking">
                                <tr>
                                    <td colspan="9" class="text-center">
                                        <i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        <!-- å®æ—¶æ•°æ® -->
        <div class="card" id="realtime" data-section="realtime">
            <div class="card-header">
                <h3>ğŸ“¡ å®æ—¶çŠ¶æ€</h3>
            </div>
            <div class="card-content">
                <div class="grid grid-2">
                    <div>
                        <h4>å¼•æ“çŠ¶æ€</h4>
                        <p>è¿è¡ŒçŠ¶æ€: <span id="engine-running" class="status-indicator">-</span></p>
                        <p>æ•°æ®å¤„ç†: <span id="data-processing" class="status-indicator">-</span></p>
                        <p>å¸‚åœºçŠ¶æ€: <span id="market-status" class="status-indicator">-</span></p>
                    </div>
                    <div>
                        <h4>å½“å‰æŒä»“</h4>
                        <div id="current-positions">
                            <p>åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- åˆ·æ–°æŒ‰é’® -->
    <button class="btn btn-primary btn-lg refresh-btn" onclick="refreshData()">
        <i class="fas fa-sync-alt"></i>
    </button>

    <script src="/static/js/dashboard.js"></script>
    <script>
        let equityChart = null;
        let pnlChart = null;
        let signalChart = null;
        let frequencyChart = null;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(refreshData, 30000);
        });

        async function refreshData() {
            try {
                await Promise.all([
                    loadOverview(),
                    loadRanking(),
                    loadRealtime(),
                    loadSignalAnalysis()
                ]);
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
                showAlert('æ•°æ®åˆ·æ–°å¤±è´¥: ' + error.message, 'danger');
            }
        }

        async function loadOverview() {
            const response = await fetch('/api/statistics/overview');
            const data = await response.json();
            
            if (data.success) {
                const summary = data.data.summary;
                
                document.querySelector('#total-strategies .stat-number').textContent = summary.total_strategies;
                document.getElementById('active-strategies').textContent = summary.active_strategies;
                document.querySelector('#total-pnl').textContent = formatCurrency(summary.total_pnl);
                document.getElementById('net-pnl').textContent = formatCurrency(summary.net_pnl);
                document.querySelector('#total-trades').textContent = summary.total_trades;
                document.getElementById('win-rate').textContent = (summary.overall_win_rate * 100).toFixed(1);
                document.querySelector('#winning-strategies').textContent = summary.winning_strategies;
                document.getElementById('winning-ratio').textContent =
                    summary.total_strategies > 0 ?
                    ((summary.winning_strategies / summary.total_strategies) * 100).toFixed(1) : '0';

                // è®¾ç½®ç›ˆäºå¡ç‰‡çŠ¶æ€
                const pnlCard = document.getElementById('pnl-card');
                if (summary.net_pnl > 0) {
                    pnlCard.classList.add('positive');
                } else if (summary.net_pnl < 0) {
                    pnlCard.classList.add('negative');
                }
            }
        }

        async function loadRanking() {
            const response = await fetch('/api/statistics/performance/ranking');
            const data = await response.json();

            if (data.success) {
                const tbody = document.getElementById('strategy-ranking');
                tbody.innerHTML = '';

                // ä¸ºæ¯ä¸ªç­–ç•¥è·å–ä¿¡å·æ•°æ®
                for (let index = 0; index < data.data.rankings.length; index++) {
                    const strategy = data.data.rankings[index];

                    // è·å–ä¿¡å·æ•°æ®
                    let signalCount = '-';
                    try {
                        const signalResponse = await fetch(`/api/statistics/signals/${strategy.strategy_name}`);
                        const signalData = await signalResponse.json();
                        if (signalData.success) {
                            signalCount = signalData.data.total_signals || 0;
                        }
                    } catch (e) {
                        console.warn(`è·å–ç­–ç•¥ ${strategy.strategy_name} ä¿¡å·æ•°æ®å¤±è´¥:`, e);
                    }

                    const row = document.createElement('tr');
                    row.className = 'strategy-row';
                    row.onclick = () => viewStrategyDetail(strategy.strategy_name);

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><strong>${strategy.strategy_name}</strong></td>
                        <td class="${strategy.net_pnl >= 0 ? 'text-success' : 'text-danger'}">
                            ${formatCurrency(strategy.net_pnl)}
                        </td>
                        <td>${(strategy.win_rate * 100).toFixed(1)}%</td>
                        <td>${strategy.total_trades}</td>
                        <td><span class="badge bg-info">${signalCount}</span></td>
                        <td class="text-danger">${(strategy.max_drawdown * 100).toFixed(2)}%</td>
                        <td>${strategy.sharpe_ratio.toFixed(2)}</td>
                        <td><span class="badge bg-success">è¿è¡Œä¸­</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); viewStrategyDetail('${strategy.strategy_name}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="event.stopPropagation(); viewSignalAnalysis('${strategy.strategy_name}')">
                                <i class="fas fa-bullseye"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            }
        }

        async function loadRealtime() {
            const response = await fetch('/api/statistics/realtime');
            const data = await response.json();
            
            if (data.success) {
                const realtime = data.data;
                
                // å¼•æ“çŠ¶æ€
                document.getElementById('engine-running').textContent = realtime.engine_status.running ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
                document.getElementById('engine-running').className = 
                    `badge ${realtime.engine_status.running ? 'bg-success' : 'bg-danger'}`;
                
                document.getElementById('data-processing').textContent = realtime.engine_status.data_processing ? 'æ­£å¸¸' : 'åœæ­¢';
                document.getElementById('data-processing').className = 
                    `badge ${realtime.engine_status.data_processing ? 'bg-success' : 'bg-warning'}`;
                
                document.getElementById('market-status').textContent = realtime.market_status;
                document.getElementById('market-status').className = 
                    `badge ${realtime.market_status === 'trading' ? 'bg-success' : 'bg-secondary'}`;
                
                // å½“å‰æŒä»“
                const positionsDiv = document.getElementById('current-positions');
                positionsDiv.innerHTML = '';
                
                if (Object.keys(realtime.current_positions).length === 0) {
                    positionsDiv.innerHTML = '<p class="text-muted">æš‚æ— æŒä»“</p>';
                } else {
                    Object.entries(realtime.current_positions).forEach(([strategy, pos]) => {
                        const posDiv = document.createElement('div');
                        posDiv.innerHTML = `
                            <strong>${strategy}</strong>: 
                            <span class="${pos.position > 0 ? 'text-success' : pos.position < 0 ? 'text-danger' : 'text-muted'}">
                                ${pos.position} æ‰‹ (${pos.symbol})
                            </span>
                        `;
                        positionsDiv.appendChild(posDiv);
                    });
                }
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('zh-CN', {
                style: 'currency',
                currency: 'CNY',
                minimumFractionDigits: 2
            }).format(value);
        }

        async function loadSignalAnalysis() {
            // è·å–ç¬¬ä¸€ä¸ªç­–ç•¥çš„ä¿¡å·åˆ†æä½œä¸ºç¤ºä¾‹
            const overviewResponse = await fetch('/api/statistics/overview');
            const overviewData = await overviewResponse.json();

            if (overviewData.success && Object.keys(overviewData.data.strategies).length > 0) {
                const firstStrategy = Object.keys(overviewData.data.strategies)[0];

                try {
                    const response = await fetch(`/api/statistics/signals/${firstStrategy}/analysis`);
                    const data = await response.json();

                    if (data.success && data.data.analysis) {
                        drawSignalCharts(data.data.analysis);
                    }
                } catch (e) {
                    console.warn('åŠ è½½ä¿¡å·åˆ†æå¤±è´¥:', e);
                }
            }
        }

        function drawSignalCharts(analysis) {
            // ç»˜åˆ¶ä¿¡å·åŠ¨ä½œåˆ†å¸ƒå›¾
            if (signalChart) signalChart.destroy();
            const signalCtx = document.getElementById('signalChart').getContext('2d');

            const actions = Object.keys(analysis.action_distribution || {});
            const actionCounts = Object.values(analysis.action_distribution || {});

            signalChart = new Chart(signalCtx, {
                type: 'doughnut',
                data: {
                    labels: actions,
                    datasets: [{
                        data: actionCounts,
                        backgroundColor: ['#4CAF50', '#f44336', '#FF9800', '#2196F3']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // ç»˜åˆ¶ä¿¡å·é¢‘ç‡åˆ†å¸ƒå›¾
            if (frequencyChart) frequencyChart.destroy();
            const frequencyCtx = document.getElementById('frequencyChart').getContext('2d');

            const hours = Object.keys(analysis.signal_frequency || {}).sort((a, b) => parseInt(a) - parseInt(b));
            const frequencies = hours.map(hour => analysis.signal_frequency[hour]);

            frequencyChart = new Chart(frequencyCtx, {
                type: 'bar',
                data: {
                    labels: hours.map(h => `${h}:00`),
                    datasets: [{
                        label: 'ä¿¡å·æ•°é‡',
                        data: frequencies,
                        backgroundColor: '#2196F3',
                        borderColor: '#1976D2',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function viewStrategyDetail(strategyName) {
            // è·³è½¬åˆ°ç­–ç•¥è¯¦æƒ…é¡µé¢
            window.open(`/strategy_detail?name=${strategyName}`, '_blank');
        }

        function viewSignalAnalysis(strategyName) {
            // æ˜¾ç¤ºä¿¡å·åˆ†æè¯¦æƒ…
            fetch(`/api/statistics/signals/${strategyName}/analysis`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showSignalAnalysisModal(strategyName, data.data);
                    } else {
                        showAlert('è·å–ä¿¡å·åˆ†æå¤±è´¥: ' + data.message, 'warning');
                    }
                })
                .catch(error => {
                    showAlert('è·å–ä¿¡å·åˆ†æå¤±è´¥: ' + error.message, 'danger');
                });
        }

        function showSignalAnalysisModal(strategyName, analysisData) {
            const analysis = analysisData.analysis || {};
            const recentSignals = analysisData.recent_signals || [];

            let modalContent = `
                <div class="modal fade" id="signalAnalysisModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-bullseye"></i> ${strategyName} - ä¿¡å·åˆ†æ
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>ä¿¡å·ç»Ÿè®¡</h6>
                                        <p>æ€»ä¿¡å·æ•°: <strong>${analysis.total_signals || 0}</strong></p>
                                        <p>åŠ¨ä½œåˆ†å¸ƒ:</p>
                                        <ul>
            `;

            Object.entries(analysis.action_distribution || {}).forEach(([action, count]) => {
                modalContent += `<li>${action}: ${count}</li>`;
            });

            modalContent += `
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>è§¦å‘åŸå› </h6>
                                        <ul>
            `;

            Object.entries(analysis.trigger_reasons || {}).forEach(([reason, count]) => {
                modalContent += `<li>${reason}: ${count}</li>`;
            });

            modalContent += `
                                        </ul>
                                    </div>
                                </div>

                                <h6>æœ€è¿‘ä¿¡å·</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>æ—¶é—´</th>
                                                <th>åŠ¨ä½œ</th>
                                                <th>ä»·æ ¼</th>
                                                <th>åŸå› </th>
                                            </tr>
                                        </thead>
                                        <tbody>
            `;

            recentSignals.forEach(signal => {
                const time = new Date(signal.timestamp * 1000).toLocaleString();
                modalContent += `
                    <tr>
                        <td>${time}</td>
                        <td><span class="badge ${signal.action === 'BUY' ? 'bg-success' : 'bg-danger'}">${signal.action}</span></td>
                        <td>${signal.price?.toFixed(2) || '-'}</td>
                        <td>${signal.reason || '-'}</td>
                    </tr>
                `;
            });

            modalContent += `
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ç§»é™¤æ—§çš„æ¨¡æ€æ¡†
            const oldModal = document.getElementById('signalAnalysisModal');
            if (oldModal) oldModal.remove();

            // æ·»åŠ æ–°çš„æ¨¡æ€æ¡†
            document.body.insertAdjacentHTML('beforeend', modalContent);

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            const modal = new bootstrap.Modal(document.getElementById('signalAnalysisModal'));
            modal.show();
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });

                // é«˜äº®å¯¹åº”çš„å¯¼èˆªæŒ‰é’®
                document.querySelectorAll('.btn-group .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }
        }

        function exportData() {
            // å¯¼å‡ºç»Ÿè®¡æ•°æ®
            showAlert('æ•°æ®å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        function showAlert(message, type = 'info') {
            // ç®€å•çš„æç¤ºåŠŸèƒ½
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.top = '80px';  // è°ƒæ•´ä½ç½®é¿å…è¢«å¯¼èˆªæ é®æŒ¡
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // é¡µé¢æ»šåŠ¨æ—¶é«˜äº®å½“å‰åŒºåŸŸçš„å¯¼èˆªæŒ‰é’®
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('[data-section]');
            const navButtons = document.querySelectorAll('.btn-group .btn');

            let currentSection = '';
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 200 && rect.bottom >= 200) {
                    currentSection = section.getAttribute('data-section');
                }
            });

            navButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('onclick')?.includes(currentSection)) {
                    btn.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
