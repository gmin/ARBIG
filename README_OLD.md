# ARBIG é‡åŒ–äº¤æ˜“ç³»ç»Ÿ

> **A**lgorithmic **R**eal-time **B**asis **I**nvestment **G**ateway
> ä¸“ä¸šçš„é‡åŒ–äº¤æ˜“ç®¡ç†å¹³å°

## ğŸ¯ é¡¹ç›®ç®€ä»‹

ARBIG æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œä¸“æ³¨äºé»„é‡‘è·¨å¸‚åœºå¥—åˆ©å’Œé‡åŒ–ç­–ç•¥äº¤æ˜“ã€‚ç³»ç»Ÿé‡‡ç”¨ Web ç®¡ç†æ¶æ„ï¼Œæä¾›å®Œæ•´çš„äº¤æ˜“ç®¡ç†ã€é£æ§ç®¡ç†å’Œç³»ç»Ÿç›‘æ§åŠŸèƒ½ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ›ï¸ **Webç®¡ç†ç•Œé¢** - ç°ä»£åŒ–çš„äº¤æ˜“ç®¡ç†æ§åˆ¶å°
- ğŸ›¡ï¸ **å®æ—¶é£æ§** - ç´§æ€¥æš‚åœã€ä¸€é”®å¹³ä»“ç­‰é£æ§åŠŸèƒ½
- ğŸ“Š **äº¤æ˜“ç›‘æ§** - å®æ—¶ç›‘æ§äº¤æ˜“ä¿¡å·ã€è®¢å•çŠ¶æ€ã€æŒä»“æƒ…å†µ
- ğŸ”§ **APIæœåŠ¡** - å®Œæ•´çš„REST APIæ¥å£
- âš¡ **é«˜æ€§èƒ½** - åŸºäºvnpyçš„äº‹ä»¶é©±åŠ¨æ¶æ„
- ğŸ”’ **å®‰å…¨å¯é ** - å¤šå±‚é£æ§ä¿æŠ¤æœºåˆ¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ARBIG é‡åŒ–äº¤æ˜“ç³»ç»Ÿ
â”œâ”€â”€ web_admin/          ğŸ›ï¸ Webç®¡ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ äº¤æ˜“ç®¡ç†         # æ‰‹åŠ¨ä¸‹å•ã€è®¢å•ç®¡ç†
â”‚   â”œâ”€â”€ é£æ§ç®¡ç†         # ç´§æ€¥æš‚åœã€ä¸€é”®å¹³ä»“
â”‚   â”œâ”€â”€ ç³»ç»Ÿç›‘æ§         # æœåŠ¡çŠ¶æ€ã€å»¶æ—¶ç›‘æ§
â”‚   â”œâ”€â”€ ä¿¡å·ç›‘æ§         # äº¤æ˜“ä¿¡å·è·Ÿè¸ªåˆ†æ
â”‚   â””â”€â”€ å†å²è®°å½•         # æ“ä½œæ—¥å¿—ã€äº¤æ˜“å†å²
â”‚
â”œâ”€â”€ trading_api/        ğŸ”§ äº¤æ˜“APIæœåŠ¡
â”‚   â”œâ”€â”€ äº¤æ˜“æ¥å£         # ä¸‹å•ã€æ’¤å•ã€æŸ¥è¯¢
â”‚   â”œâ”€â”€ è´¦æˆ·æ¥å£         # èµ„é‡‘ã€æŒä»“æŸ¥è¯¢
â”‚   â”œâ”€â”€ è¡Œæƒ…æ¥å£         # å®æ—¶è¡Œæƒ…ã€å†å²æ•°æ®
â”‚   â””â”€â”€ é£æ§æ¥å£         # é£é™©æ§åˆ¶API
â”‚
â””â”€â”€ core/              âš™ï¸ æ ¸å¿ƒç³»ç»Ÿ
    â”œâ”€â”€ äº‹ä»¶å¼•æ“         # é«˜æ€§èƒ½äº‹ä»¶å¤„ç†
    â”œâ”€â”€ æœåŠ¡ç»„ä»¶         # äº¤æ˜“ã€é£æ§ã€æ•°æ®æœåŠ¡
    â”œâ”€â”€ CTPç½‘å…³          # æœŸè´§äº¤æ˜“æ¥å£
    â””â”€â”€ ç­–ç•¥å¼•æ“         # é‡åŒ–ç­–ç•¥æ‰§è¡Œ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.8+ (æ¨èä½¿ç”¨vnpyç¯å¢ƒ)
- **æ“ä½œç³»ç»Ÿ**: Linux/Windows
- **ä¾èµ–**: vnpy, vnpy-ctp, fastapi, uvicorn

## å®‰è£…ä¾èµ–

### ç³»ç»Ÿä¾èµ–

```bash
# å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒæ”¯æŒ
sudo apt-get install python3.10-venv

# å®‰è£…TA-Libä¾èµ–åº“
wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
tar -xzf ta-lib-0.4.0-src.tar.gz
cd ta-lib/
./configure --prefix=/usr/local
make
sudo make install
sudo ldconfig
```

### Pythonä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.10 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt
```

## é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

ç³»ç»Ÿä½¿ç”¨ `config.yaml` ä½œä¸ºä¸»é…ç½®æ–‡ä»¶ï¼š

```yaml
# äº‹ä»¶å¼•æ“é…ç½®
event_persist_path: "events.jsonl"

# æ•°æ®æºé…ç½®
data:
  shfe:
    gateway: "CTP"
    host: "180.168.146.187"
    port: 10101
    user: "your_username"
    password: "your_password"
    broker_id: "9999"
    
  mt5:
    server: "MetaQuotes-Demo"
    login: 12345
    password: "your_password"
    symbol: "XAUUSD"

# ç­–ç•¥é…ç½®
strategies:
  - name: "spread_arbitrage"
    type: "spread_arbitrage"
    config:
      spread_threshold: 0.5
      max_position: 1000
      shfe_symbol: "AU9999"
      mt5_symbol: "XAUUSD"
      
  - name: "shfe_quant"
    type: "shfe_quant"
    config:
      strategy_type: "trend"
      symbol: "AU9999"
      max_position: 1000
      ma_short: 5
      ma_long: 20
      rsi_period: 14
      rsi_overbought: 70
      rsi_oversold: 30
```

## ä½¿ç”¨æ–¹æ³•

### 1. åˆ—å‡ºå¯ç”¨ç­–ç•¥

```bash
python main.py --list
```

### 2. æŒ‡å®šç­–ç•¥è¿è¡Œ

```bash
# è¿è¡ŒåŸºå·®å¥—åˆ©ç­–ç•¥
python main.py --strategy spread_arbitrage

# è¿è¡Œä¸Šæµ·å¸‚åœºé‡åŒ–ç­–ç•¥
python main.py --strategy shfe_quant
```

### 3. äº¤äº’å¼é€‰æ‹©ç­–ç•¥

```bash
python main.py
```

ç³»ç»Ÿä¼šæ˜¾ç¤ºç­–ç•¥é€‰æ‹©èœå•ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦è¿è¡Œçš„ç­–ç•¥ã€‚

### 4. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

```bash
python main.py --config my_config.yaml --strategy spread_arbitrage
```

## ç­–ç•¥è¯´æ˜

### åŸºå·®å¥—åˆ©ç­–ç•¥ (spread_arbitrage)

ç›‘æ§é¦™æ¸¯å’Œä¸Šæµ·é»„é‡‘ä»·æ ¼ï¼Œåœ¨åŸºå·®è¾¾åˆ°é˜ˆå€¼æ—¶è¿›è¡Œå¥—åˆ©äº¤æ˜“ã€‚

**å‚æ•°è¯´æ˜ï¼š**
- `spread_threshold`: åŸºå·®é˜ˆå€¼ï¼Œè§¦å‘å¥—åˆ©çš„ä»·å·®
- `max_position`: æœ€å¤§æŒä»“é‡
- `shfe_symbol`: ä¸ŠæœŸæ‰€åˆçº¦ä»£ç 
- `mt5_symbol`: MT5åˆçº¦ä»£ç 

### ä¸Šæµ·å¸‚åœºé‡åŒ–ç­–ç•¥ (shfe_quant)

å®ç°ä¸ŠæœŸæ‰€é»„é‡‘æœŸè´§çš„é‡åŒ–äº¤æ˜“ç­–ç•¥ï¼Œæ”¯æŒå¤šç§ç­–ç•¥ç±»å‹ã€‚

**ç­–ç•¥ç±»å‹ï¼š**
- `trend`: è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥
- `mean_reversion`: å‡å€¼å›å½’ç­–ç•¥
- `breakout`: çªç ´ç­–ç•¥

**å‚æ•°è¯´æ˜ï¼š**
- `strategy_type`: ç­–ç•¥ç±»å‹
- `symbol`: äº¤æ˜“åˆçº¦
- `max_position`: æœ€å¤§æŒä»“
- `ma_short/ma_long`: çŸ­æœŸ/é•¿æœŸå‡çº¿å‘¨æœŸ
- `rsi_period`: RSIå‘¨æœŸ
- `rsi_overbought/rsi_oversold`: RSIè¶…ä¹°/è¶…å–é˜ˆå€¼

## ç­–ç•¥è¯¦ç»†è¯´æ˜

### 1. åŸºå·®å¥—åˆ©ç­–ç•¥ï¼ˆspread_arbitrageï¼‰

#### ç­–ç•¥åŸç†
åŸºå·®å¥—åˆ©ç­–ç•¥åˆ©ç”¨åŒä¸€æ ‡çš„ï¼ˆé»„é‡‘ï¼‰åœ¨ä¸åŒå¸‚åœºï¼ˆå¦‚é¦™æ¸¯ç¦»å²¸äººæ°‘å¸é»„é‡‘ä¸ä¸Šæµ·é»„é‡‘äº¤æ˜“æ‰€é»„é‡‘ï¼‰ä¹‹é—´çš„ä»·æ ¼å·®å¼‚ã€‚å½“åŸºå·®ï¼ˆä¸¤åœ°ä»·æ ¼ä¹‹å·®ï¼‰è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œä¹°å…¥ä½ä»·å¸‚åœºã€å–å‡ºé«˜ä»·å¸‚åœºçš„æ“ä½œï¼ŒæœŸæœ›åŸºå·®å›å½’æ—¶è·åˆ©ã€‚

#### æ ¸å¿ƒäº¤æ˜“é€»è¾‘
**åŸºå·®å¥—åˆ©çš„æ ¸å¿ƒåŸåˆ™ï¼šåœ¨ä½ä»·å¸‚åœºä¹°å…¥ï¼Œé«˜ä»·å¸‚åœºå–å‡º**

```python
# åŸºå·®è®¡ç®—ï¼šspread = SHFEä»·æ ¼ - MT5ä»·æ ¼
spread = shfe_price - mt5_price

# å¼€ä»“æ¡ä»¶ï¼šåŸºå·®è¶…è¿‡å¼€ä»“é˜ˆå€¼
if abs(spread) > entry_threshold:
    if spread > 0:
        # ä¹°å…¥MT5(ä½ä»·)ï¼Œå–å‡ºSHFE(é«˜ä»·)
        signal = 'BUY_MT5_SELL_SHFE'
    else:
        # ä¹°å…¥SHFE(ä½ä»·)ï¼Œå–å‡ºMT5(é«˜ä»·)
        signal = 'BUY_SHFE_SELL_MT5'

# å¹³ä»“æ¡ä»¶ï¼šåŸºå·®å›å½’åˆ°å¹³ä»“é˜ˆå€¼
if abs(spread) <= exit_threshold:
    signal = 'CLOSE_POSITION'
```

#### é˜ˆå€¼è®¾ç½®ç­–ç•¥
**é‡‡ç”¨ç®€å•æœ‰æ•ˆçš„å›ºå®šé˜ˆå€¼ç­–ç•¥ï¼Œé¿å…è¿‡åº¦å¤æ‚åŒ–**

- **å¼€ä»“é˜ˆå€¼**ï¼š0.8å…ƒ/å…‹ - ç¡®ä¿è¦†ç›–äº¤æ˜“æˆæœ¬å¹¶è·å¾—åˆç†åˆ©æ¶¦
- **å¹³ä»“é˜ˆå€¼**ï¼š0.2å…ƒ/å…‹ - åŠæ—¶é”å®šåˆ©æ¶¦ï¼Œé¿å…åŸºå·®åè½¬
- **ç­–ç•¥ä¼˜åŠ¿**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤ï¼Œå‡å°‘è¿‡æ‹Ÿåˆé£é™©

#### é€‚ç”¨åœºæ™¯
- ä¸¤åœ°é»„é‡‘å¸‚åœºæµåŠ¨æ€§è¾ƒå¥½ï¼Œä»·å·®æ³¢åŠ¨æ˜æ˜¾
- å…·å¤‡åŒæ—¶æ¥å…¥ä¸¤åœ°è¡Œæƒ…ä¸äº¤æ˜“é€šé“çš„æ¡ä»¶
- é€‚åˆå¥—åˆ©å‹ã€ä½é£é™©åå¥½çš„é‡åŒ–äº¤æ˜“è€…

#### ä¿¡å·ç”Ÿæˆæœºåˆ¶
- å®æ—¶ç›‘æ§ä¸¤åœ°é»„é‡‘ä»·æ ¼ï¼ˆå¦‚shfe_priceã€mt5_priceï¼‰
- è®¡ç®—åŸºå·®ï¼š`spread = shfe_price - mt5_price`
- å½“|spread|å¤§äº`spread_threshold`æ—¶ï¼Œäº§ç”Ÿå¥—åˆ©ä¿¡å·ï¼š
  - spread > thresholdï¼šä¹°å…¥MT5é»„é‡‘ï¼Œå–å‡ºSHFEé»„é‡‘
  - spread < -thresholdï¼šä¹°å…¥SHFEé»„é‡‘ï¼Œå–å‡ºMT5é»„é‡‘
- ä¿¡å·åªåœ¨åŸºå·®é¦–æ¬¡çªç ´é˜ˆå€¼æ—¶è§¦å‘ï¼Œé¿å…é¢‘ç¹äº¤æ˜“

#### å‚æ•°è¯´æ˜
| å‚æ•°å           | è¯´æ˜                 | å…¸å‹å–å€¼ | è°ƒä¼˜å»ºè®®           |
|------------------|----------------------|----------|--------------------|
| spread_threshold | è§¦å‘å¥—åˆ©çš„åŸºå·®é˜ˆå€¼   | 0.5      | ç»“åˆæ‰‹ç»­è´¹ã€æ»‘ç‚¹è®¾å®š|
| max_position     | æœ€å¤§æŒä»“é‡           | 1000     | è§†èµ„é‡‘è§„æ¨¡è°ƒæ•´     |
| shfe_symbol      | ä¸ŠæœŸæ‰€åˆçº¦ä»£ç        | AU9999   | éœ€ä¸è¡Œæƒ…ä¸€è‡´       |
| mt5_symbol       | MT5åˆçº¦ä»£ç           | XAUUSD   | éœ€ä¸è¡Œæƒ…ä¸€è‡´       |

#### é£é™©æç¤º
- **åŸºå·®é£é™©**ï¼šåŸºå·®å¯èƒ½ä¸ä¼šå›å½’ï¼Œç”šè‡³è¿›ä¸€æ­¥æ‰©å¤§
- **è…¿å·®é£é™©**ï¼šä¸€è…¿æˆäº¤ï¼Œå¦ä¸€è…¿æœªæˆäº¤æˆ–æ»‘ç‚¹å¤§
- **æµåŠ¨æ€§é£é™©**ï¼šæŸä¸€å¸‚åœºæµåŠ¨æ€§ä¸è¶³ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶å¹³ä»“
- **æ±‡ç‡é£é™©**ï¼šå¦‚æ¶‰åŠä¸åŒå¸ç§ï¼Œéœ€å…³æ³¨æ±‡ç‡æ³¢åŠ¨
- **æŠ€æœ¯é£é™©**ï¼šè¡Œæƒ…å»¶è¿Ÿã€ä¸‹å•å¤±è´¥ã€ç³»ç»Ÿæ•…éšœç­‰

#### ç¤ºä¾‹æµç¨‹ï¼ˆä¼ªä»£ç ï¼‰
```python
while True:
    shfe_price = get_shfe_price()
    mt5_price = get_mt5_price()
    spread = shfe_price - mt5_price
    
    if spread > spread_threshold:
        # ä¹°å…¥MT5(ä½ä»·)ï¼Œå–å‡ºSHFE(é«˜ä»·)
        send_signal('BUY_MT5_SELL_SHFE')
    elif spread < -spread_threshold:
        # ä¹°å…¥SHFE(ä½ä»·)ï¼Œå–å‡ºMT5(é«˜ä»·)
        send_signal('BUY_SHFE_SELL_MT5')
    
    sleep(1)
```

---

### 2. ä¸Šæµ·é‡åŒ–ç­–ç•¥ï¼ˆshfe_quantï¼‰

#### ç­–ç•¥æ¶æ„
ä¸Šæµ·é‡åŒ–ç­–ç•¥é‡‡ç”¨**åˆ†å±‚è®¾è®¡**ï¼ŒåŒ…å«ä¸‰ä¸ªå­ç­–ç•¥ï¼š
- **çªç ´ç­–ç•¥ï¼ˆbreakoutï¼‰**ï¼š**æ–¹å‘åˆ¤æ–­å™¨**ï¼Œè¯†åˆ«å¸‚åœºæ–¹å‘ï¼ˆåšå¤š/åšç©ºï¼‰
- **è¶‹åŠ¿è·Ÿè¸ªï¼ˆtrendï¼‰**ï¼šåŸºäºå‡çº¿äº¤å‰çš„è¶‹åŠ¿ç­–ç•¥
- **å‡å€¼å›å½’ï¼ˆmean_reversionï¼‰**ï¼šåŸºäºRSIçš„éœ‡è¡ç­–ç•¥

#### ç­–ç•¥åŸç†

##### çªç ´ç­–ç•¥ï¼ˆæ–¹å‘åˆ¤æ–­å™¨ï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šåˆ¤æ–­å¸‚åœºæ–¹å‘ï¼ŒæŒ‡å¯¼å…¶ä»–ç­–ç•¥çš„åšå¤šåšç©ºå†³ç­–
- **åˆ¤æ–­é€»è¾‘**ï¼šä»·æ ¼çªç ´å¸ƒæ—å¸¦ä¸Šè½¨â†’åšå¤šæ–¹å‘ï¼Œè·Œç ´ä¸‹è½¨â†’åšç©ºæ–¹å‘
- **ç½®ä¿¡åº¦è®¡ç®—**ï¼šåŸºäºçªç ´å¼ºåº¦å’Œè¶‹åŠ¿ä¸€è‡´æ€§
- **ä¿¡å·è¾“å‡º**ï¼šæ–¹å‘ä¿¡å·ï¼ˆLONG/SHORT/NEUTRALï¼‰+ ç½®ä¿¡åº¦

##### è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šåŸºäºå‡çº¿äº¤å‰çš„è¶‹åŠ¿è·Ÿè¸ª
- **ä¿¡å·é€»è¾‘**ï¼šçŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿â†’ä¹°å…¥ï¼Œä¸‹ç©¿â†’å–å‡º
- **æ–¹å‘çº¦æŸ**ï¼šæ ¹æ®çªç ´ç­–ç•¥çš„æ–¹å‘åˆ¤æ–­è°ƒæ•´æ“ä½œ
- **ä»“ä½ç®¡ç†**ï¼šæ ¹æ®æ–¹å‘ç½®ä¿¡åº¦è°ƒæ•´ä»“ä½å¤§å°

##### å‡å€¼å›å½’ç­–ç•¥
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šåŸºäºRSIçš„éœ‡è¡äº¤æ˜“
- **ä¿¡å·é€»è¾‘**ï¼šRSIè¶…å–â†’ä¹°å…¥ï¼Œè¶…ä¹°â†’å–å‡º
- **æ–¹å‘çº¦æŸ**ï¼šæ ¹æ®çªç ´ç­–ç•¥çš„æ–¹å‘åˆ¤æ–­è°ƒæ•´æ“ä½œ
- **ä»“ä½ç®¡ç†**ï¼šæ ¹æ®æ–¹å‘ç½®ä¿¡åº¦è°ƒæ•´ä»“ä½å¤§å°

#### é€‚ç”¨åœºæ™¯
- **è¶‹åŠ¿å¸‚åœº**ï¼šçªç ´ç­–ç•¥è¯†åˆ«è¶‹åŠ¿æ–¹å‘ï¼Œè¶‹åŠ¿ç­–ç•¥é¡ºåŠ¿æ“ä½œ
- **éœ‡è¡å¸‚åœº**ï¼šçªç ´ç­–ç•¥è¯†åˆ«åŒºé—´çªç ´ï¼Œå‡å€¼å›å½’ç­–ç•¥åœ¨åŒºé—´å†…æ“ä½œ
- **è½¬æŠ˜å¸‚åœº**ï¼šçªç ´ç­–ç•¥æå‰è¯†åˆ«æ–¹å‘å˜åŒ–ï¼Œå…¶ä»–ç­–ç•¥åŠæ—¶è°ƒæ•´

#### ä¿¡å·ç”Ÿæˆæœºåˆ¶

##### çªç ´ç­–ç•¥ï¼ˆæ–¹å‘åˆ¤æ–­ï¼‰
```python
# è®¡ç®—å¸ƒæ—å¸¦
upper, lower = calculate_bollinger_bands(price_history)
current_price = price_history[-1]
strength = calculate_breakout_strength(current_price, upper, lower)

# æ–¹å‘åˆ¤æ–­
if current_price > upper and strength > 0.5:
    direction = 'LONG'
    confidence = calculate_confidence(direction, strength)
    send_direction_signal(direction, confidence)
elif current_price < lower and strength > 0.5:
    direction = 'SHORT'
    confidence = calculate_confidence(direction, strength)
    send_direction_signal(direction, confidence)
```

##### è¶‹åŠ¿ç­–ç•¥ï¼ˆç»“åˆæ–¹å‘åˆ¤æ–­ï¼‰
```python
# è®¡ç®—å‡çº¿
ma_short = mean(price_history[-ma_short_period:])
ma_long = mean(price_history[-ma_long_period:])

# åŸå§‹ä¿¡å·
if ma_short > ma_long and position <= 0:
    original_signal = 'BUY'
elif ma_short < ma_long and position >= 0:
    original_signal = 'SELL'

# æ ¹æ®æ–¹å‘è°ƒæ•´ä¿¡å·
if direction == 'LONG' and confidence > 0.5:
    if original_signal == 'BUY':
        final_signal = 'BUY'
    elif original_signal == 'SELL':
        final_signal = 'CLOSE_LONG'  # å¹³å¤šè€Œä¸æ˜¯åšç©º
elif direction == 'SHORT' and confidence > 0.5:
    if original_signal == 'BUY':
        final_signal = 'CLOSE_SHORT'  # å¹³ç©ºè€Œä¸æ˜¯åšå¤š
    elif original_signal == 'SELL':
        final_signal = 'SELL'
```

##### å‡å€¼å›å½’ç­–ç•¥ï¼ˆç»“åˆæ–¹å‘åˆ¤æ–­ï¼‰
```python
# è®¡ç®—RSI
rsi = calculate_rsi(price_history, rsi_period)

# åŸå§‹ä¿¡å·
if rsi < rsi_oversold and position <= 0:
    original_signal = 'BUY'
elif rsi > rsi_overbought and position >= 0:
    original_signal = 'SELL'

# æ ¹æ®æ–¹å‘è°ƒæ•´ä¿¡å·ï¼ˆç±»ä¼¼è¶‹åŠ¿ç­–ç•¥ï¼‰
```

#### å‚æ•°è¯´æ˜
| å‚æ•°å           | è¯´æ˜                 | å…¸å‹å–å€¼ | è°ƒä¼˜å»ºè®®           |
|------------------|----------------------|----------|--------------------|
| strategy_type    | ç­–ç•¥ç±»å‹             | trend/mean_reversion/breakout | æ ¹æ®å¸‚åœºé€‰æ‹© |
| symbol           | äº¤æ˜“åˆçº¦ä»£ç          | AU9999   | ä¸è¡Œæƒ…ä¸€è‡´         |
| max_position     | æœ€å¤§æŒä»“é‡           | 1000     | è§†èµ„é‡‘è§„æ¨¡è°ƒæ•´     |
| ma_short         | çŸ­æœŸå‡çº¿å‘¨æœŸ         | 5        | è¶‹åŠ¿ç­–ç•¥ç”¨         |
| ma_long          | é•¿æœŸå‡çº¿å‘¨æœŸ         | 20       | è¶‹åŠ¿ç­–ç•¥ç”¨         |
| rsi_period       | RSIå‘¨æœŸ              | 14       | å‡å€¼å›å½’ç”¨         |
| rsi_overbought   | RSIè¶…ä¹°é˜ˆå€¼          | 70       | å‡å€¼å›å½’ç”¨         |
| rsi_oversold     | RSIè¶…å–é˜ˆå€¼          | 30       | å‡å€¼å›å½’ç”¨         |

#### é£é™©æç¤º
- **çªç ´ç­–ç•¥**ï¼šå‡çªç ´å¯èƒ½å¯¼è‡´æ–¹å‘åˆ¤æ–­é”™è¯¯ï¼Œå½±å“å…¶ä»–ç­–ç•¥
- **è¶‹åŠ¿ç­–ç•¥**ï¼šéœ‡è¡å¸‚æ˜“é¢‘ç¹æ­¢æŸï¼Œè¶‹åŠ¿åè½¬æ—¶å¯èƒ½æ»å
- **å‡å€¼å›å½’**ï¼šå¼ºè¶‹åŠ¿å¸‚æ˜“é€†åŠ¿äºæŸï¼Œé˜ˆå€¼è®¾ç½®ä¸å½“æ˜“é¢‘ç¹äº¤æ˜“
- **æ–¹å‘ä¾èµ–**ï¼šå…¶ä»–ç­–ç•¥è¿‡åº¦ä¾èµ–çªç ´ç­–ç•¥çš„æ–¹å‘åˆ¤æ–­
- **å‚æ•°è¿‡æ‹Ÿåˆ**ï¼šå†å²æœ€ä¼˜å‚æ•°æœªå¿…é€‚åˆæœªæ¥è¡Œæƒ…
- **æŠ€æœ¯é£é™©**ï¼šè¡Œæƒ…å»¶è¿Ÿã€æ•°æ®å¼‚å¸¸ã€ç³»ç»Ÿæ•…éšœç­‰

#### ç­–ç•¥ååŒç¤ºä¾‹

##### å®Œæ•´æµç¨‹ç¤ºä¾‹
```python
# 1. çªç ´ç­–ç•¥åˆ¤æ–­æ–¹å‘
def breakout_direction():
    upper, lower = calc_bollinger_bands(price_history)
    price = price_history[-1]
    strength = calc_breakout_strength(price, upper, lower)
    
    if price > upper and strength > 0.5:
        return 'LONG', calculate_confidence('LONG', strength)
    elif price < lower and strength > 0.5:
        return 'SHORT', calculate_confidence('SHORT', strength)
    return 'NEUTRAL', 0.0

# 2. è¶‹åŠ¿ç­–ç•¥æ ¹æ®æ–¹å‘è°ƒæ•´
def trend_strategy_with_direction():
    direction, confidence = breakout_direction()
    
    # è®¡ç®—å‡çº¿ä¿¡å·
    ma_signal = calculate_ma_signal()
    
    # æ ¹æ®æ–¹å‘è°ƒæ•´
    if direction == 'LONG' and confidence > 0.5:
        if ma_signal == 'BUY':
            return 'BUY', calculate_position(confidence)
        elif ma_signal == 'SELL':
            return 'CLOSE_LONG', -current_position
    elif direction == 'SHORT' and confidence > 0.5:
        if ma_signal == 'BUY':
            return 'CLOSE_SHORT', -current_position
        elif ma_signal == 'SELL':
            return 'SELL', calculate_position(confidence)
    
    return None, 0

# 3. å‡å€¼å›å½’ç­–ç•¥ç±»ä¼¼å¤„ç†
```

##### ä»“ä½ç®¡ç†ç¤ºä¾‹
```python
def calculate_position(confidence):
    base_position = 100
    
    if confidence > 0.7:
        return base_position  # é«˜ç½®ä¿¡åº¦ï¼Œæ­£å¸¸ä»“ä½
    elif confidence > 0.5:
        return int(base_position * 0.8)  # ä¸­ç­‰ç½®ä¿¡åº¦ï¼Œå‡å°‘ä»“ä½
    else:
        return int(base_position * 0.5)  # ä½ç½®ä¿¡åº¦ï¼Œå¤§å¹…å‡å°‘ä»“ä½
```

---

### 3. ç­–ç•¥ç»„åˆä¸æ–¹å‘åˆ¤æ–­

#### çªç ´ç­–ç•¥æ–¹å‘åŒ–
çªç ´ç­–ç•¥å·²é‡æ–°è®¾è®¡ä¸º**æ–¹å‘åˆ¤æ–­å™¨**ï¼Œä¸»è¦ä½œç”¨ï¼š

1. **å¸‚åœºæ–¹å‘è¯†åˆ«**ï¼š
   - æ£€æµ‹ä»·æ ¼çªç ´å¸ƒæ—å¸¦ä¸Šä¸‹è½¨
   - åˆ¤æ–­å¸‚åœºæ–¹å‘ï¼ˆåšå¤š/åšç©º/ä¸­æ€§ï¼‰
   - æä¾›æ–¹å‘ç½®ä¿¡åº¦

2. **ä¸»ç­–ç•¥æŒ‡å¯¼**ï¼š
   - ä¸ºè¶‹åŠ¿ç­–ç•¥æä¾›æ–¹å‘æŒ‡å¯¼
   - ä¸ºå‡å€¼å›å½’ç­–ç•¥æä¾›æ–¹å‘æŒ‡å¯¼
   - é¿å…é€†åŠ¿æ“ä½œ

3. **ä»“ä½ç®¡ç†**ï¼š
   - æ ¹æ®æ–¹å‘ç½®ä¿¡åº¦è°ƒæ•´ä»“ä½
   - é«˜ç½®ä¿¡åº¦æ—¶æ­£å¸¸ä»“ä½
   - ä½ç½®ä¿¡åº¦æ—¶å‡å°‘ä»“ä½

#### ç­–ç•¥ååŒç¤ºä¾‹
```python
# çªç ´ç­–ç•¥åˆ¤æ–­æ–¹å‘
if breakout_direction == 'LONG' and confidence > 0.7:
    # é«˜ç½®ä¿¡åº¦åšå¤šæ–¹å‘
    if trend_signal == 'BUY':
        execute_buy(full_position)
    elif trend_signal == 'SELL':
        execute_close_long()  # å¹³å¤šè€Œä¸æ˜¯åšç©º
elif breakout_direction == 'SHORT' and confidence > 0.7:
    # é«˜ç½®ä¿¡åº¦åšç©ºæ–¹å‘
    if trend_signal == 'BUY':
        execute_close_short()  # å¹³ç©ºè€Œä¸æ˜¯åšå¤š
    elif trend_signal == 'SELL':
        execute_sell(full_position)
else:
    # ä¸­æ€§æ–¹å‘ï¼Œå‡å°‘ä»“ä½
    execute_with_reduced_position()
```

## ç³»ç»Ÿæ¶æ„

```
ARBIG/
â”œâ”€â”€ main.py              # ä¸»æ§åˆ¶å™¨
â”œâ”€â”€ config.yaml          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ core/                # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ event_engine.py  # äº‹ä»¶å¼•æ“
â”‚   â”œâ”€â”€ data.py          # æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ strategy_base.py # ç­–ç•¥åŸºç±»
â”‚   â””â”€â”€ constants.py     # å¸¸é‡å®šä¹‰
â”œâ”€â”€ strategies/          # ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ spread_arbitrage.py  # åŸºå·®å¥—åˆ©ç­–ç•¥
â”‚   â””â”€â”€ shfe_quant.py        # ä¸Šæµ·å¸‚åœºé‡åŒ–ç­–ç•¥
â”œâ”€â”€ config/              # é…ç½®æ¨¡å—
â”œâ”€â”€ utils/               # å·¥å…·æ¨¡å—
â””â”€â”€ tests/               # æµ‹è¯•æ¨¡å—
```

## äº‹ä»¶ç³»ç»Ÿ

ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œä¸»è¦äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼š

- `TICK_EVENT`: Tickæ•°æ®äº‹ä»¶
- `BAR_EVENT`: Kçº¿æ•°æ®äº‹ä»¶
- `SIGNAL_EVENT`: ç­–ç•¥ä¿¡å·äº‹ä»¶
- `ORDER_EVENT`: è®¢å•äº‹ä»¶
- `TRADE_EVENT`: æˆäº¤äº‹ä»¶
- `ACCOUNT_EVENT`: è´¦æˆ·äº‹ä»¶

## å•ç­–ç•¥è¿è¡Œæ¨¡å¼

ä¸ºäº†é¿å…å¤šä¸ªç­–ç•¥åŒæ—¶è¿è¡Œé€ æˆçš„å¹²æ‰°ï¼Œç³»ç»Ÿé‡‡ç”¨å•ç­–ç•¥è¿è¡Œæ¨¡å¼ï¼š

1. **ç­–ç•¥éš”ç¦»**ï¼šä¸€æ¬¡åªè¿è¡Œä¸€ä¸ªç­–ç•¥
2. **äº‹ä»¶åˆ†å‘**ï¼šä¸»æ§åˆ¶å™¨ç»Ÿä¸€ç®¡ç†äº‹ä»¶åˆ†å‘
3. **èµ„æºç‹¬å **ï¼šå½“å‰ç­–ç•¥ç‹¬å æ•°æ®æºå’Œè®¡ç®—èµ„æº
4. **çŠ¶æ€ç®¡ç†**ï¼šæ¸…æ™°çš„ç­–ç•¥å¯åŠ¨/åœæ­¢çŠ¶æ€ç®¡ç†

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç­–ç•¥

1. ç»§æ‰¿ `StrategyBase` ç±»
2. å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•
3. åœ¨ `main.py` ä¸­æ·»åŠ ç­–ç•¥åˆ›å»ºé€»è¾‘
4. åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç­–ç•¥é…ç½®

### ç¤ºä¾‹

```python
from core.strategy_base import StrategyBase

class MyStrategy(StrategyBase):
    def on_start(self):
        print("ç­–ç•¥å¯åŠ¨")
        
    def on_stop(self):
        print("ç­–ç•¥åœæ­¢")
        
    def on_tick(self, event):
        # å¤„ç†Tickæ•°æ®
        pass
        
    # å®ç°å…¶ä»–æŠ½è±¡æ–¹æ³•...
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®æºé…ç½®**ï¼šè¯·æ ¹æ®å®é™…æƒ…å†µé…ç½®æ•°æ®æºè¿æ¥å‚æ•°
2. **é£æ§è®¾ç½®**ï¼šå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨é£æ§æ¨¡å—
3. **æ—¥å¿—ç›‘æ§**ï¼šå®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼Œç¡®ä¿ç­–ç•¥æ­£å¸¸è¿è¡Œ
4. **ç­–ç•¥æµ‹è¯•**ï¼šæ–°ç­–ç•¥å»ºè®®å…ˆåœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­å……åˆ†æµ‹è¯•

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚ 