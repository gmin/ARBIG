import{c as t,A as K,G as I,d as Q,r as d,o as X,f as Y,j as r,g as O,p as b,k as m,w as n,m as u,l as V,S as Z,R as ee,t as f,y as N,F as te,q as le,H as ne,s as oe,n as F}from"./index-6e58ba50.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"};const re=se;function P(l){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(_){return Object.getOwnPropertyDescriptor(s,_).enumerable}))),c.forEach(function(_){ie(l,_,s[_])})}return l}function ie(l,o,s){return o in l?Object.defineProperty(l,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):l[o]=s,l}var x=function(o,s){var c=P({},o,s.attrs);return t(K,P({},c,{icon:re}),null)};x.displayName="ClearOutlined";x.inheritAttrs=!1;const ue=x,ce={getLogFiles:async()=>(await I.get("/logs/files")).data,getLogContent:async l=>{const o=new URLSearchParams;return l.service&&o.append("service",l.service),l.filename&&o.append("filename",l.filename),l.lines&&o.append("lines",l.lines.toString()),l.level&&o.append("level",l.level),l.search&&o.append("search",l.search),l.start_time&&o.append("start_time",l.start_time),l.end_time&&o.append("end_time",l.end_time),(await I.get(`/logs/content?${o.toString()}`)).data},downloadLogFile:(l,o)=>`/api/v1/logs/download/${l}/${o}`},de={class:"log-viewer"},_e={class:"log-controls"},ve={class:"log-content"},pe={key:0,class:"log-info"},fe={class:"log-timestamp"},ge={class:"log-module"},me={class:"log-message"},he={key:0,class:"no-logs"},we=Q({__name:"LogViewer",props:{defaultService:{default:"main"}},setup(l){const s=d(l.defaultService),c=d(),_=d(""),R=d(100),B=d(!1),w=d(!1),k=d([]),g=d(),S=d();let h=null;const v=async()=>{w.value=!0;try{const i={service:s.value,lines:R.value,level:c.value,search:_.value||void 0},e=await ce.getLogContent(i);k.value=e.logs,g.value=e,await ne(),S.value&&(S.value.scrollTop=S.value.scrollHeight)}catch(i){oe.error("加载日志失败"),console.error("Load logs error:",i)}finally{w.value=!1}},U=()=>{k.value=[],g.value=void 0},z=i=>{i?h=setInterval(v,5e3):h&&(clearInterval(h),h=null)},E=i=>{if(i===0)return"0 B";const e=1024,p=["B","KB","MB","GB"],C=Math.floor(Math.log(i)/Math.log(e));return parseFloat((i/Math.pow(e,C)).toFixed(2))+" "+p[C]},M=i=>new Date(i).toLocaleString();return X(()=>{v()}),Y(()=>{h&&clearInterval(h)}),(i,e)=>{const p=r("a-select-option"),C=r("a-select"),L=r("a-col"),A=r("a-input"),$=r("a-input-number"),H=r("a-button"),G=r("a-switch"),j=r("a-space"),D=r("a-row"),y=r("a-descriptions-item"),T=r("a-descriptions"),W=r("a-empty"),q=r("a-spin");return O(),b("div",de,[m("div",_e,[t(D,{gutter:16,align:"middle"},{default:n(()=>[t(L,{span:4},{default:n(()=>[t(C,{value:s.value,"onUpdate:value":e[0]||(e[0]=a=>s.value=a),placeholder:"选择服务",onChange:v},{default:n(()=>[t(p,{value:"main"},{default:n(()=>e[5]||(e[5]=[u("主系统",-1)])),_:1,__:[5]}),t(p,{value:"web_admin"},{default:n(()=>e[6]||(e[6]=[u("Web管理",-1)])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),t(L,{span:3},{default:n(()=>[t(C,{value:c.value,"onUpdate:value":e[1]||(e[1]=a=>c.value=a),placeholder:"日志级别","allow-clear":"",onChange:v},{default:n(()=>[t(p,{value:"DEBUG"},{default:n(()=>e[7]||(e[7]=[u("DEBUG",-1)])),_:1,__:[7]}),t(p,{value:"INFO"},{default:n(()=>e[8]||(e[8]=[u("INFO",-1)])),_:1,__:[8]}),t(p,{value:"WARNING"},{default:n(()=>e[9]||(e[9]=[u("WARNING",-1)])),_:1,__:[9]}),t(p,{value:"ERROR"},{default:n(()=>e[10]||(e[10]=[u("ERROR",-1)])),_:1,__:[10]})]),_:1},8,["value"])]),_:1}),t(L,{span:4},{default:n(()=>[t(A,{value:_.value,"onUpdate:value":e[2]||(e[2]=a=>_.value=a),placeholder:"搜索关键词",onPressEnter:v},{suffix:n(()=>[t(V(Z),{onClick:v})]),_:1},8,["value"])]),_:1}),t(L,{span:3},{default:n(()=>[t($,{value:R.value,"onUpdate:value":e[3]||(e[3]=a=>R.value=a),min:10,max:1e3,placeholder:"行数",onChange:v},null,8,["value"])]),_:1}),t(L,{span:6},{default:n(()=>[t(j,null,{default:n(()=>[t(H,{onClick:v,loading:w.value},{default:n(()=>[t(V(ee)),e[11]||(e[11]=u(" 刷新 ",-1))]),_:1,__:[11]},8,["loading"]),t(H,{onClick:U},{default:n(()=>[t(V(ue)),e[12]||(e[12]=u(" 清空 ",-1))]),_:1,__:[12]}),t(G,{checked:B.value,"onUpdate:checked":e[4]||(e[4]=a=>B.value=a),"checked-children":"自动刷新","un-checked-children":"手动刷新",onChange:z},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),m("div",ve,[t(q,{spinning:w.value},{default:n(()=>[g.value?(O(),b("div",pe,[t(T,{size:"small",column:4},{default:n(()=>[t(y,{label:"文件路径"},{default:n(()=>[u(f(g.value.file_path),1)]),_:1}),t(y,{label:"总行数"},{default:n(()=>[u(f(g.value.total_lines),1)]),_:1}),t(y,{label:"文件大小"},{default:n(()=>[u(f(E(g.value.file_size)),1)]),_:1}),t(y,{label:"最后修改"},{default:n(()=>[u(f(M(g.value.last_modified)),1)]),_:1})]),_:1})])):N("",!0),m("div",{class:"log-entries",ref_key:"logContainer",ref:S},[(O(!0),b(te,null,le(k.value,(a,J)=>(O(),b("div",{key:J,class:F(["log-entry",`log-${a.level.toLowerCase()}`,a.level.toLowerCase()==="info"?"log-info":"",a.level.toLowerCase()==="warning"?"log-warning":"",a.level.toLowerCase()==="error"?"log-error":""])},[m("span",fe,f(a.timestamp),1),m("span",{class:F(["log-level",`level-${a.level.toLowerCase()}`])}," ["+f(a.level)+"] ",3),m("span",ge,f(a.module),1),m("span",me,f(a.message),1)],2))),128)),k.value.length===0&&!w.value?(O(),b("div",he,[t(W,{description:"暂无日志数据"})])):N("",!0)],512)]),_:1},8,["spinning"])])])}}});const Oe=ae(we,[["__scopeId","data-v-03f34c8a"]]);export{Oe as L};
