import{c as e,A as T,d as U,r as h,e as D,o as J,g as v,p as P,w as n,s as f,j as u,k as N,l as b,m as w,h as $,t as x,y as z}from"./index-61eac750.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";var F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};const G=F;function B(i){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),c.forEach(function(s){H(i,s,t[s])})}return i}function H(i,o,t){return o in i?Object.defineProperty(i,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[o]=t,i}var C=function(o,t){var c=B({},o,t.attrs);return e(T,B({},c,{icon:G}),null)};C.displayName="StarOutlined";C.inheritAttrs=!1;const k=C,Q={class:"market-page"},R={class:"main-contract-section"},W={class:"contract-info"},X={key:0,class:"no-contract"},Y={key:1,class:"market-data"},Z=U({__name:"Market",setup(i){const o=h(""),t=h(""),c=h(!1),s=h({lastPrice:0,change:0,changePercent:0,volume:0,openPrice:0,highPrice:0,lowPrice:0,preClosePrice:0}),O=D(()=>{if(!t.value)return"";const r=t.value.match(/(\w+)(\d{4})/);if(!r)return"";const[,a,d]=r,l="20"+d.substring(0,2),_=d.substring(2,4);return`${l}年${_}月`}),y=D(()=>{if(!t.value)return!1;const r=t.value.match(/(\w+)(\d{4})/);if(!r)return!1;const[,a,d]=r,l=parseInt("20"+d.substring(0,2)),_=parseInt(d.substring(2,4)),m=new Date;return new Date(l,_-1)<m}),S=r=>r>0?"#f5222d":r<0?"#52c41a":"#666666",I=async()=>{try{const a=await(await fetch("/api/v1/system/config/market_data")).json();a.success&&(t.value=a.data.main_contract||"",o.value=t.value,(!t.value||y.value)&&f.warning("请设置有效的主力合约"))}catch(r){console.error("加载主力合约失败:",r)}},L=async()=>{if(!o.value.trim()){f.error("请输入主力合约代码");return}c.value=!0;try{const a=await(await fetch("/api/v1/system/config/market_data/save_main_contract",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({main_contract:o.value.trim().toUpperCase()})})).json();a.success?(t.value=o.value.trim().toUpperCase(),f.success("主力合约保存成功"),M()):f.error(`保存失败: ${a.message}`)}catch(r){f.error("保存主力合约失败"),console.error("保存主力合约失败:",r)}finally{c.value=!1}},M=async()=>{if(t.value)try{const a=await(await fetch(`/api/v1/data/market/price/${t.value}`)).json();a.success&&a.data&&(s.value={lastPrice:a.data.last_price||0,change:a.data.change||0,changePercent:a.data.change_percent||0,volume:a.data.volume||0,openPrice:a.data.open_price||0,highPrice:a.data.high_price||0,lowPrice:a.data.low_price||0,preClosePrice:a.data.pre_close_price||0})}catch(r){console.error("加载行情数据失败:",r)}};return J(()=>{I(),setInterval(()=>{t.value&&M()},5e3)}),(r,a)=>{const d=u("a-input"),l=u("a-col"),_=u("a-button"),m=u("a-tag"),g=u("a-row"),j=u("a-card"),E=u("a-empty"),p=u("a-statistic"),V=u("a-divider");return v(),P("div",Q,[e(j,{title:"主力合约配置",class:"mb-4"},{default:n(()=>[N("div",R,[e(g,{gutter:16,align:"middle"},{default:n(()=>[e(l,{span:6},{default:n(()=>[e(d,{value:o.value,"onUpdate:value":a[0]||(a[0]=A=>o.value=A),placeholder:"输入主力合约，如: au2509",size:"large",disabled:c.value},{prefix:n(()=>[e(b(k),{style:{color:"#faad14"}})]),_:1},8,["value","disabled"])]),_:1}),e(l,{span:4},{default:n(()=>[e(_,{type:"primary",size:"large",loading:c.value,onClick:L},{default:n(()=>a[1]||(a[1]=[w(" 保存主力合约 ",-1)])),_:1,__:[1]},8,["loading"])]),_:1}),e(l,{span:14},{default:n(()=>[N("div",W,[t.value?(v(),$(m,{key:0,color:"gold",class:"mr-2"},{default:n(()=>[e(b(k),{class:"mr-1"}),w(" 当前主力合约: "+x(t.value),1)]),_:1})):z("",!0),O.value?(v(),$(m,{key:1,color:y.value?"red":"green"},{default:n(()=>[w(x(y.value?"已过期":"有效")+": "+x(O.value),1)]),_:1},8,["color"])):z("",!0)])]),_:1})]),_:1})])]),_:1}),e(j,{title:"实时行情"},{default:n(()=>[t.value?(v(),P("div",Y,[e(g,{gutter:16},{default:n(()=>[e(l,{span:8},{default:n(()=>[e(p,{title:"最新价",value:s.value.lastPrice||"--",suffix:"元","value-style":{color:S(s.value.change)}},null,8,["value","value-style"])]),_:1}),e(l,{span:8},{default:n(()=>[e(p,{title:"涨跌幅",value:s.value.changePercent||"--",suffix:"%","value-style":{color:S(s.value.change)}},null,8,["value","value-style"])]),_:1}),e(l,{span:8},{default:n(()=>[e(p,{title:"成交量",value:s.value.volume||"--",suffix:"手"},null,8,["value"])]),_:1})]),_:1}),e(V),e(g,{gutter:16},{default:n(()=>[e(l,{span:6},{default:n(()=>[e(p,{title:"开盘价",value:s.value.openPrice||"--",suffix:"元"},null,8,["value"])]),_:1}),e(l,{span:6},{default:n(()=>[e(p,{title:"最高价",value:s.value.highPrice||"--",suffix:"元"},null,8,["value"])]),_:1}),e(l,{span:6},{default:n(()=>[e(p,{title:"最低价",value:s.value.lowPrice||"--",suffix:"元"},null,8,["value"])]),_:1}),e(l,{span:6},{default:n(()=>[e(p,{title:"昨收价",value:s.value.preClosePrice||"--",suffix:"元"},null,8,["value"])]),_:1})]),_:1})])):(v(),P("div",X,[e(E,{description:"请先设置主力合约"},{image:n(()=>[e(b(k),{style:{"font-size":"48px",color:"#faad14"}})]),_:1})]))]),_:1})])}}});const te=q(Z,[["__scopeId","data-v-799143ce"]]);export{te as default};
