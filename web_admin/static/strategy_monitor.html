<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­–ç•¥ç›‘æ§ - ARBIGé‡åŒ–äº¤æ˜“ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 300% 100%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .back-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            position: relative;
            overflow: hidden;
        }

        .back-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .back-btn:hover::before {
            left: 100%;
        }

        .strategy-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .info-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .info-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .info-item:hover::before {
            transform: scaleX(1);
        }

        .info-label {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            line-height: 1.2;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2);
        }

        .panel:hover::before {
            opacity: 1;
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-running { background: #27ae60; }
        .status-stopped { background: #e74c3c; }
        .status-paused { background: #f39c12; }

        .control-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-start {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        .btn-stop {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        .btn-pause {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }


        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .btn:hover::before {
            left: 100%;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 25px 20px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .metric-card:hover::before {
            transform: scaleX(1);
        }

        .metric-value {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            line-height: 1;
        }

        .metric-label {
            font-size: 13px;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        .neutral { color: #3498db; }

        .log-container {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            border-radius: 16px;
            padding: 20px;
            height: 350px;
            overflow-y: auto;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .log-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c);
            background-size: 300% 100%;
            animation: logGradient 4s ease infinite;
        }

        @keyframes logGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .log-container::-webkit-scrollbar {
            width: 8px;
        }

        .log-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .log-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .log-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 6px 0;
            border-left: 3px solid transparent;
            padding-left: 10px;
            transition: all 0.2s ease;
        }

        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: #3498db;
        }

        .log-timestamp {
            color: #95a5a6;
            margin-right: 12px;
            font-weight: 500;
        }

        .log-level-INFO {
            color: #3498db;
            text-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .log-level-WARN {
            color: #f39c12;
            text-shadow: 0 0 5px rgba(243, 156, 18, 0.3);
        }
        .log-level-ERROR {
            color: #e74c3c;
            text-shadow: 0 0 5px rgba(231, 76, 60, 0.3);
        }
        .log-level-DEBUG {
            color: #95a5a6;
            text-shadow: 0 0 5px rgba(149, 165, 166, 0.3);
        }

        .positions-table, .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .positions-table th, .positions-table td,
        .orders-table th, .orders-table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s ease;
        }

        .positions-table th, .orders-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .positions-table tbody tr, .orders-table tbody tr {
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
        }

        .positions-table tbody tr:hover, .orders-table tbody tr:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.01);
        }

        .positions-table tbody tr:nth-child(even),
        .orders-table tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.9);
        }

        /* ç­–ç•¥è§¦å‘è®°å½•æ ·å¼ */
        .trigger-container {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .trigger-container::-webkit-scrollbar {
            width: 6px;
        }

        .trigger-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .trigger-container::-webkit-scrollbar-thumb {
            background: rgba(46, 204, 113, 0.5);
            border-radius: 3px;
        }

        .trigger-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #2ecc71;
            transition: all 0.3s ease;
            position: relative;
        }

        .trigger-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.2);
        }

        .trigger-time {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .trigger-condition {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .trigger-action {
            font-size: 13px;
            color: #34495e;
            margin-bottom: 8px;
            font-style: italic;
        }

        .trigger-result {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }

        .trigger-result.success {
            background: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }

        .trigger-result.warning {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
        }

        .trigger-result.error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        /* å‚æ•°ç¼–è¾‘æ ·å¼ */
        .param-edit-form {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border: 2px solid #3498db;
        }

        .param-edit-form.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .param-input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .param-input {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .param-input label {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
        }

        .param-input input, .param-input select {
            padding: 8px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .param-input input:focus, .param-input select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .param-input select {
            cursor: pointer;
        }

        /* å¼€ä»“æ¨¡å¼æè¿°æ ·å¼ */
        .mode-description {
            margin-top: 6px;
            padding: 8px;
            background: rgba(52, 152, 219, 0.1);
            border-left: 3px solid #3498db;
            border-radius: 4px;
            font-size: 12px;
            line-height: 1.3;
            color: #2c3e50;
        }

        .mode-description strong {
            color: #2980b9;
            font-weight: 600;
        }

        .mode-description .risk-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .risk-low { background: #d5f4e6; color: #27ae60; }
        .risk-medium { background: #fef9e7; color: #f39c12; }
        .risk-high { background: #fadbd8; color: #e74c3c; }

        .mode-features {
            margin-top: 4px;
            font-size: 11px;
            color: #7f8c8d;
        }

        .mode-features ul {
            margin: 2px 0 0 12px;
            padding: 0;
        }

        .mode-features li {
            margin-bottom: 1px;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease;
            cursor: move;
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(52, 152, 219, 0.5);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(52, 152, 219, 0.7);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-content .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-content .close:hover {
            color: #e74c3c;
        }

        .modal-content h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 700;
            cursor: move;
            user-select: none;
            padding: 10px 0;
            border-bottom: 2px solid #ecf0f1;
            position: relative;
        }

        .modal-content h3::after {
            content: 'â‹®â‹®';
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            color: #bdc3c7;
            font-size: 16px;
            letter-spacing: 2px;
        }

        .modal-content h3:hover::after {
            color: #3498db;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .button-group .btn {
            min-width: 100px;
        }

        /* å›æµ‹ç»“æœæ ·å¼ */
        .backtest-results {
            margin-top: 25px;
            padding: 20px;
            background: rgba(52, 152, 219, 0.05);
            border-radius: 16px;
            border-left: 4px solid #3498db;
        }

        .backtest-results h4 {
            color: #2980b9;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .chart-container {
            height: 300px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-style: italic;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-running {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }
        .status-stopped {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        .status-paused {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* åŠ è½½åŠ¨ç”» */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .panel, .header, .info-item, .metric-card {
            animation: fadeInUp 0.6s ease forwards;
        }

        .panel:nth-child(2) { animation-delay: 0.1s; }
        .panel:nth-child(3) { animation-delay: 0.2s; }
        .info-item:nth-child(2) { animation-delay: 0.1s; }
        .info-item:nth-child(3) { animation-delay: 0.2s; }
        .info-item:nth-child(4) { animation-delay: 0.3s; }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .container {
                padding: 15px;
            }

            .main-content {
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .strategy-info {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .control-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .header h1 {
                font-size: 24px;
            }

            .panel {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .strategy-info {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 20px;
            }

            .info-item, .metric-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <h1>
                ğŸ“Š ç­–ç•¥ç›‘æ§è¯¦æƒ…
                <a href="/" class="back-btn">â† è¿”å›ä¸»é¡µ</a>
            </h1>
            
            <!-- ç­–ç•¥åŸºæœ¬ä¿¡æ¯ -->
            <div class="strategy-info">
                <div class="info-item">
                    <div class="info-label">ç­–ç•¥åç§°</div>
                    <div class="info-value" id="strategy-name">åŠ è½½ä¸­...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¿è¡ŒçŠ¶æ€</div>
                    <div class="info-value" id="strategy-status">
                        <span class="status-indicator status-stopped"></span>
                        å·²åœæ­¢
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¿è¡Œæ—¶é•¿</div>
                    <div class="info-value" id="strategy-uptime">00:00:00</div>
                </div>
                <div class="info-item">
                    <div class="info-label">é£é™©ç­‰çº§</div>
                    <div class="info-value" id="strategy-risk">ä¸­ç­‰</div>
                </div>
                <div class="info-item">
                    <div class="info-label">äº¤æ˜“åˆçº¦</div>
                    <div class="info-value" id="strategy-symbol">au2507</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æœ€å¤§æŒä»“</div>
                    <div class="info-value" id="strategy-max-pos">1æ‰‹</div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- ç­–ç•¥æ§åˆ¶é¢æ¿ -->
            <div class="panel">
                <h2>ğŸ® ç­–ç•¥æ§åˆ¶</h2>
                
                <div class="control-buttons">
                    <button class="btn btn-start" id="btn-start">
                        â–¶ï¸ å¯åŠ¨ç­–ç•¥
                    </button>
                    <button class="btn btn-pause" id="btn-pause" disabled>
                        â¸ï¸ æš‚åœç­–ç•¥
                    </button>
                    <button class="btn btn-stop" id="btn-stop" disabled>
                        â¹ï¸ åœæ­¢ç­–ç•¥
                    </button>
                </div>



                <!-- ç­–ç•¥å‚æ•° -->
                <div style="margin-top: 25px; padding: 20px; background: rgba(52, 152, 219, 0.1); border-radius: 16px; border-left: 4px solid #3498db;">
                    <h3 style="color: #2980b9; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        âš™ï¸ ç­–ç•¥å‚æ•°
                        <button class="btn btn-info btn-sm" id="btn-edit-params" style="margin-left: auto; padding: 8px 16px; font-size: 12px;">
                            ç¼–è¾‘å‚æ•°
                        </button>
                        <button class="btn btn-success btn-sm" id="btn-backtest" style="padding: 8px 16px; font-size: 12px;">
                            å†å²å›æµ‹
                        </button>
                    </h3>
                    <div class="strategy-info">
                        <div class="info-item">
                            <div class="info-label">çŸ­æœŸå‡çº¿</div>
                            <div class="info-value" id="param-ma-short">5</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">é•¿æœŸå‡çº¿</div>
                            <div class="info-value" id="param-ma-long">20</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">RSIå‘¨æœŸ</div>
                            <div class="info-value" id="param-rsi-period">14</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">è¶…ä¹°é˜ˆå€¼</div>
                            <div class="info-value" id="param-rsi-overbought">70</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æ­¢æŸæ¯”ä¾‹</div>
                            <div class="info-value" id="param-stop-loss">0.05</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æ­¢ç›ˆæ¯”ä¾‹</div>
                            <div class="info-value" id="param-take-profit">0.08</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">å¼€ä»“æ‰‹æ•°</div>
                            <div class="info-value" id="param-position-size">1</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æœ€å¤§æŒä»“</div>
                            <div class="info-value" id="param-max-position">5</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">é£é™©ç³»æ•°</div>
                            <div class="info-value" id="param-risk-factor">0.02</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">åŠ ä»“é—´éš”</div>
                            <div class="info-value" id="param-add-interval">50</div>
                        </div>
                        <div class="info-item" style="grid-column: span 2;">
                            <div class="info-label">å¼€ä»“æ¨¡å¼</div>
                            <div class="info-value" id="param-position-mode">å›ºå®šæ‰‹æ•°</div>
                            <div class="mode-description" id="current-mode-description" style="margin-top: 8px;">
                                <strong>å›ºå®šæ‰‹æ•°:</strong> æ¯æ¬¡å¼€ä»“ä½¿ç”¨å›ºå®šçš„æ‰‹æ•°ï¼Œç®€å•ç¨³å®šï¼Œé€‚åˆæ–°æ‰‹å’Œä¿å®ˆç­–ç•¥ã€‚
                                <span class="risk-level risk-low">ä½é£é™©</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ä»“ä½å€æ•°</div>
                            <div class="info-value" id="param-position-multiplier">1.0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®æ—¶æŒ‡æ ‡ -->
            <div class="panel">
                <h2>ğŸ“ˆ å®æ—¶æŒ‡æ ‡</h2>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value positive" id="total-pnl">+0.00</div>
                        <div class="metric-label">æ€»ç›ˆäº</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="current-pos">0</div>
                        <div class="metric-label">å½“å‰æŒä»“</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="trade-count">0</div>
                        <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="win-rate">0%</div>
                        <div class="metric-label">èƒœç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="max-drawdown">0.00</div>
                        <div class="metric-label">æœ€å¤§å›æ’¤</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="sharpe-ratio">0.00</div>
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                    </div>
                </div>

                <!-- ç­–ç•¥è§¦å‘è®°å½• -->
                <div style="margin-top: 25px; padding: 20px; background: rgba(46, 204, 113, 0.1); border-radius: 16px; border-left: 4px solid #2ecc71;">
                    <h3 style="color: #27ae60; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        ğŸ¯ ç­–ç•¥è§¦å‘è®°å½•
                        <button class="btn btn-secondary btn-sm" id="btn-clear-triggers" style="margin-left: auto; padding: 6px 12px; font-size: 12px;">
                            æ¸…ç©ºè®°å½•
                        </button>
                    </h3>
                    <div id="trigger-records" class="trigger-container">
                        <div class="trigger-item">
                            <div class="trigger-time">2024-01-15 14:30:25</div>
                            <div class="trigger-condition">
                                <strong>ä¹°å…¥ä¿¡å·:</strong> MA5(435.2) > MA20(434.8), RSI(25.6) < 30
                            </div>
                            <div class="trigger-action">
                                æ‰§è¡Œæ“ä½œ: ä¹°å…¥ au2406 1æ‰‹ @ 435.5 (å¼€ä»“æ‰‹æ•°: 1, é£é™©ç³»æ•°: 0.02)
                            </div>
                            <div class="trigger-result success">âœ… è®¢å•å·²æˆäº¤</div>
                        </div>
                        <div class="trigger-item">
                            <div class="trigger-time">2024-01-15 14:25:10</div>
                            <div class="trigger-condition">
                                <strong>å–å‡ºä¿¡å·:</strong> MA5(434.1) < MA20(434.5), RSI(75.2) > 70
                            </div>
                            <div class="trigger-action">
                                æ‰§è¡Œæ“ä½œ: å–å‡º au2406 1æ‰‹ @ 434.0 (å¹³ä»“æ“ä½œ, æ­¢ç›ˆ: 8%)
                            </div>
                            <div class="trigger-result success">âœ… è®¢å•å·²æˆäº¤</div>
                        </div>
                        <div class="trigger-item">
                            <div class="trigger-time">2024-01-15 14:20:05</div>
                            <div class="trigger-condition">
                                <strong>æ­¢æŸä¿¡å·:</strong> ä»·æ ¼(433.2) < æ­¢æŸä»·(433.5)
                            </div>
                            <div class="trigger-action">
                                æ‰§è¡Œæ“ä½œ: æ­¢æŸå¹³ä»“ au2406 1æ‰‹ @ 433.2 (æ­¢æŸ: 5%, äºæŸ: -0.3ç‚¹)
                            </div>
                            <div class="trigger-result warning">âš ï¸ æ­¢æŸæ‰§è¡Œ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æŒä»“å’Œè®¢å•ä¿¡æ¯ -->
        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“‹ å½“å‰æŒä»“</h2>
                <table class="positions-table">
                    <thead>
                        <tr>
                            <th>åˆçº¦</th>
                            <th>æ–¹å‘</th>
                            <th>æ•°é‡</th>
                            <th>å¼€ä»“ä»·</th>
                            <th>å½“å‰ä»·</th>
                            <th>ç›ˆäº</th>
                        </tr>
                    </thead>
                    <tbody id="positions-tbody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #666;">æš‚æ— æŒä»“</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="panel">
                <h2>ğŸ“ æ´»è·ƒè®¢å•</h2>
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>è®¢å•å·</th>
                            <th>åˆçº¦</th>
                            <th>æ–¹å‘</th>
                            <th>æ•°é‡</th>
                            <th>ä»·æ ¼</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="orders-tbody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #666;">æš‚æ— æ´»è·ƒè®¢å•</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ç­–ç•¥æ—¥å¿— -->
        <div class="panel full-width">
            <h2>ğŸ“‹ ç­–ç•¥æ—¥å¿—</h2>
            <div class="log-container" id="strategy-logs">
                <div class="log-entry">
                    <span class="log-timestamp">2025-07-09 17:45:00</span>
                    <span class="log-level-INFO">[INFO]</span>
                    ç­–ç•¥ç›‘æ§é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…ç­–ç•¥å¯åŠ¨...
                </div>
            </div>
        </div>
    </div>

    <!-- å‚æ•°ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="paramEditModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeParamModal()">&times;</span>
            <h3>âš™ï¸ ç¼–è¾‘ç­–ç•¥å‚æ•°</h3>
            <form id="paramEditForm">
                <div class="param-input-group">
                    <div class="param-input">
                        <label for="edit-ma-short">çŸ­æœŸå‡çº¿å‘¨æœŸ</label>
                        <input type="number" id="edit-ma-short" min="1" max="50" value="5">
                    </div>
                    <div class="param-input">
                        <label for="edit-ma-long">é•¿æœŸå‡çº¿å‘¨æœŸ</label>
                        <input type="number" id="edit-ma-long" min="10" max="200" value="20">
                    </div>
                    <div class="param-input">
                        <label for="edit-rsi-period">RSIå‘¨æœŸ</label>
                        <input type="number" id="edit-rsi-period" min="5" max="50" value="14">
                    </div>
                    <div class="param-input">
                        <label for="edit-rsi-overbought">RSIè¶…ä¹°é˜ˆå€¼</label>
                        <input type="number" id="edit-rsi-overbought" min="50" max="90" value="70">
                    </div>
                    <div class="param-input">
                        <label for="edit-stop-loss">æ­¢æŸæ¯”ä¾‹ (%)</label>
                        <input type="number" id="edit-stop-loss" min="1" max="20" step="0.1" value="5">
                    </div>
                    <div class="param-input">
                        <label for="edit-take-profit">æ­¢ç›ˆæ¯”ä¾‹ (%)</label>
                        <input type="number" id="edit-take-profit" min="1" max="50" step="0.1" value="8">
                    </div>
                    <div class="param-input">
                        <label for="edit-position-size">å¼€ä»“æ‰‹æ•°</label>
                        <input type="number" id="edit-position-size" min="1" max="20" value="1">
                    </div>
                    <div class="param-input">
                        <label for="edit-max-position">æœ€å¤§æŒä»“æ‰‹æ•°</label>
                        <input type="number" id="edit-max-position" min="1" max="50" value="5">
                    </div>
                    <div class="param-input">
                        <label for="edit-risk-factor">é£é™©ç³»æ•°</label>
                        <input type="number" id="edit-risk-factor" min="0.01" max="0.1" step="0.01" value="0.02">
                        <small style="color: #7f8c8d; font-size: 12px; margin-top: 4px; display: block;">
                            å•ç¬”äº¤æ˜“é£é™©å æ€»èµ„é‡‘çš„æ¯”ä¾‹ï¼Œ0.02è¡¨ç¤º2%ï¼Œå»ºè®®ä¸è¶…è¿‡5%
                        </small>
                    </div>
                    <div class="param-input">
                        <label for="edit-add-interval">åŠ ä»“é—´éš” (ç‚¹)</label>
                        <input type="number" id="edit-add-interval" min="10" max="200" value="50">
                        <small style="color: #7f8c8d; font-size: 12px; margin-top: 4px; display: block;">
                            ä»·æ ¼å˜åŠ¨å¤šå°‘ç‚¹åå…è®¸åŠ ä»“ï¼Œé˜²æ­¢é¢‘ç¹åŠ ä»“ï¼Œå»ºè®®æ ¹æ®å“ç§æ³¢åŠ¨æ€§è®¾ç½®
                        </small>
                    </div>
                    <div class="param-input">
                        <label for="edit-position-mode">å¼€ä»“æ¨¡å¼</label>
                        <div style="display: flex; gap: 8px; align-items: flex-end;">
                            <select id="edit-position-mode" onchange="updatePositionModeDescription()" style="flex: 1;">
                                <option value="fixed">å›ºå®šæ‰‹æ•°</option>
                                <option value="risk_based">é£é™©æ¯”ä¾‹</option>
                                <option value="kelly">å‡¯åˆ©å…¬å¼</option>
                                <option value="martingale">é©¬ä¸æ ¼å°”</option>
                            </select>
                            <button type="button" onclick="testPositionMode()" style="
                                padding: 8px 12px;
                                background: linear-gradient(135deg, #3498db, #2980b9);
                                color: white;
                                border: none;
                                border-radius: 4px;
                                font-size: 11px;
                                cursor: pointer;
                                white-space: nowrap;
                            ">ğŸ§® æµ‹è¯•</button>
                        </div>
                        <div id="position-mode-description" class="mode-description">
                            <strong>å›ºå®šæ‰‹æ•°:</strong> æ¯æ¬¡å¼€ä»“ä½¿ç”¨å›ºå®šçš„æ‰‹æ•°ï¼Œç®€å•ç¨³å®šï¼Œé€‚åˆæ–°æ‰‹å’Œä¿å®ˆç­–ç•¥ã€‚
                        </div>
                    </div>
                    <div class="param-input">
                        <label for="edit-position-multiplier">ä»“ä½å€æ•°</label>
                        <input type="number" id="edit-position-multiplier" min="0.1" max="5" step="0.1" value="1.0">
                        <small style="color: #7f8c8d; font-size: 12px; margin-top: 4px; display: block;">
                            è°ƒæ•´æœ€ç»ˆä»“ä½å¤§å°çš„å€æ•°ï¼Œ1.0ä¸ºæ ‡å‡†ï¼Œå¤§äº1.0å¢åŠ ä»“ä½ï¼Œå°äº1.0å‡å°‘ä»“ä½
                        </small>
                    </div>
                </div>

                <!-- å‚æ•°è¯´æ˜åŒºåŸŸ -->
                <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.05); border-radius: 8px; border-left: 3px solid #3498db;">
                    <h4 style="color: #2980b9; margin-bottom: 8px; font-size: 13px; cursor: pointer; user-select: none;" onclick="toggleParamHelp()">
                        ğŸ’¡ å‚æ•°è¯´æ˜ <span id="param-help-toggle">â–¼</span>
                    </h4>
                    <div id="param-help-content" style="font-size: 12px; color: #2c3e50; line-height: 1.4;">
                        <p style="margin: 4px 0;"><strong>æŠ€æœ¯æŒ‡æ ‡:</strong> å½±å“ä¹°å–ä¿¡å·ç”Ÿæˆï¼Œå»ºè®®æ ¹æ®å›æµ‹è°ƒæ•´ã€‚</p>
                        <p style="margin: 4px 0;"><strong>é£é™©æ§åˆ¶:</strong> æ­¢æŸæ­¢ç›ˆæ¯”ä¾‹å½±å“é£é™©æ”¶ç›Šæ¯”ã€‚</p>
                        <p style="margin: 4px 0;"><strong>å¼€ä»“å‚æ•°:</strong> æ§åˆ¶ä»“ä½å¤§å°ï¼Œå»ºè®®å°ä»“ä½æµ‹è¯•ã€‚</p>
                        <p style="margin: 4px 0;"><strong>âš ï¸ æé†’:</strong> ä¿®æ”¹åå»ºè®®å…ˆå›æµ‹éªŒè¯æ•ˆæœã€‚</p>
                    </div>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-success" onclick="saveStrategyParams()">ä¿å­˜å‚æ•°</button>
                    <button type="button" class="btn btn-secondary" onclick="closeParamModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å›æµ‹æ¨¡æ€æ¡† -->
    <div id="backtestModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeBacktestModal()">&times;</span>
            <h3>ğŸ“Š ç­–ç•¥å†å²å›æµ‹</h3>
            <div class="backtest-form">
                <div class="param-input-group">
                    <div class="param-input">
                        <label for="backtest-start-date">å¼€å§‹æ—¥æœŸ</label>
                        <input type="date" id="backtest-start-date" value="2024-01-01">
                    </div>
                    <div class="param-input">
                        <label for="backtest-end-date">ç»“æŸæ—¥æœŸ</label>
                        <input type="date" id="backtest-end-date" value="2024-01-15">
                    </div>
                    <div class="param-input">
                        <label for="backtest-initial-capital">åˆå§‹èµ„é‡‘</label>
                        <input type="number" id="backtest-initial-capital" min="10000" step="1000" value="100000">
                    </div>
                    <div class="param-input">
                        <label for="backtest-commission">æ‰‹ç»­è´¹ç‡ (%)</label>
                        <input type="number" id="backtest-commission" min="0" max="1" step="0.01" value="0.05">
                    </div>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-primary" onclick="startBacktest()">å¼€å§‹å›æµ‹</button>
                    <button type="button" class="btn btn-secondary" onclick="closeBacktestModal()">å–æ¶ˆ</button>
                </div>
            </div>
            <div id="backtest-results" class="backtest-results" style="display: none;">
                <h4>ğŸ“ˆ å›æµ‹ç»“æœ</h4>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="backtest-total-return">0.00%</div>
                        <div class="metric-label">æ€»æ”¶ç›Šç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="backtest-annual-return">0.00%</div>
                        <div class="metric-label">å¹´åŒ–æ”¶ç›Šç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="backtest-max-drawdown">0.00%</div>
                        <div class="metric-label">æœ€å¤§å›æ’¤</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="backtest-sharpe">0.00</div>
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="backtest-win-rate">0.00%</div>
                        <div class="metric-label">èƒœç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="backtest-trade-count">0</div>
                        <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>
                    </div>
                </div>
                <div id="backtest-chart" style="height: 300px; margin-top: 20px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                    å›æµ‹å›¾è¡¨å°†åœ¨æ­¤æ˜¾ç¤º
                </div>
            </div>
        </div>
    </div>

    <script>
        // è·å–URLå‚æ•°ä¸­çš„ç­–ç•¥åç§°
        const urlParams = new URLSearchParams(window.location.search);
        const strategyName = urlParams.get('strategy') || 'shfe_quant';
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œç­–ç•¥åç§°
        document.getElementById('strategy-name').textContent = strategyName;
        document.title = `${strategyName} - ç­–ç•¥ç›‘æ§`;

        // APIç«¯ç‚¹
        const API_BASE = '/api/v1';
        
        // ç­–ç•¥çŠ¶æ€
        let currentStatus = 'stopped';
        let logContainer = document.getElementById('strategy-logs');
        
        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(level, message) {
            const timestamp = new Date().toLocaleString('zh-CN');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">${timestamp}</span>
                <span class="log-level-${level}">[${level}]</span>
                ${message}
            `;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // æ›´æ–°ç­–ç•¥çŠ¶æ€æ˜¾ç¤º
        function updateStrategyStatus(status) {
            currentStatus = status;
            const statusElement = document.getElementById('strategy-status');
            const indicator = statusElement.querySelector('.status-indicator');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const startBtn = document.getElementById('btn-start');
            const pauseBtn = document.getElementById('btn-pause');
            const stopBtn = document.getElementById('btn-stop');
            
            switch(status) {
                case 'running':
                    statusElement.innerHTML = '<span class="status-indicator status-running"></span> è¿è¡Œä¸­';
                    startBtn.disabled = true;
                    pauseBtn.disabled = false;
                    stopBtn.disabled = false;
                    break;
                case 'paused':
                    statusElement.innerHTML = '<span class="status-indicator status-paused"></span> å·²æš‚åœ';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = false;
                    break;
                default:
                    statusElement.innerHTML = '<span class="status-indicator status-stopped"></span> å·²åœæ­¢';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = true;
            }
        }
        
        // ç­–ç•¥æ§åˆ¶å‡½æ•°
        async function controlStrategy(action) {
            try {
                addLogEntry('INFO', `æ­£åœ¨${action}ç­–ç•¥...`);
                
                const response = await fetch(`${API_BASE}/strategies/${action}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        strategy_name: strategyName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLogEntry('INFO', `ç­–ç•¥${action}æˆåŠŸ: ${result.message}`);
                    
                    // æ›´æ–°çŠ¶æ€
                    if (action === 'start') updateStrategyStatus('running');
                    else if (action === 'halt') updateStrategyStatus('paused');
                    else if (action === 'stop') updateStrategyStatus('stopped');
                    
                } else {
                    addLogEntry('ERROR', `ç­–ç•¥${action}å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                addLogEntry('ERROR', `ç­–ç•¥${action}å¼‚å¸¸: ${error.message}`);
            }
        }
        
        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.getElementById('btn-start').addEventListener('click', () => controlStrategy('start'));
        document.getElementById('btn-pause').addEventListener('click', () => controlStrategy('halt'));
        document.getElementById('btn-stop').addEventListener('click', () => controlStrategy('stop'));



        // ç»‘å®šæ–°åŠŸèƒ½æŒ‰é’®äº‹ä»¶
        document.getElementById('btn-edit-params').addEventListener('click', () => showParamEditModal());
        document.getElementById('btn-backtest').addEventListener('click', () => showBacktestModal());
        document.getElementById('btn-clear-triggers').addEventListener('click', () => clearTriggerRecords());
        
        // åŠ è½½ç­–ç•¥è¯¦ç»†ä¿¡æ¯
        async function loadStrategyDetails() {
            try {
                const response = await fetch(`${API_BASE}/strategies/${strategyName}/details`);
                const result = await response.json();

                if (result.success && result.data) {
                    const strategy = result.data;

                    // æ›´æ–°ç­–ç•¥åŸºæœ¬ä¿¡æ¯
                    document.getElementById('strategy-name').textContent = strategy.display_name;
                    updateStrategyStatus(strategy.status);

                    // æ›´æ–°è¿è¡Œæ—¶é•¿
                    document.getElementById('strategy-uptime').textContent = strategy.runtime || '00:00:00';

                    // æ›´æ–°å®æ—¶æŒ‡æ ‡
                    if (strategy.statistics) {
                        const stats = strategy.statistics;
                        document.getElementById('total-pnl').textContent =
                            (stats.current_profit >= 0 ? '+' : '') + stats.current_profit.toFixed(2);
                        document.getElementById('total-pnl').className =
                            'metric-value ' + (stats.current_profit >= 0 ? 'positive' : 'negative');

                        document.getElementById('current-pos').textContent = '0'; // æš‚æ—¶ç¡¬ç¼–ç 
                        document.getElementById('trade-count').textContent = stats.successful_trades + stats.failed_trades;
                        document.getElementById('win-rate').textContent = (stats.win_rate * 100).toFixed(1) + '%';
                        document.getElementById('max-drawdown').textContent = stats.max_drawdown.toFixed(2);
                        document.getElementById('sharpe-ratio').textContent = stats.sharpe_ratio.toFixed(2);
                    }

                    addLogEntry('INFO', `ç­–ç•¥è¯¦ç»†ä¿¡æ¯åŠ è½½æˆåŠŸ: ${strategy.display_name}`);
                } else {
                    addLogEntry('ERROR', `åŠ è½½ç­–ç•¥è¯¦ç»†ä¿¡æ¯å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                addLogEntry('ERROR', `åŠ è½½ç­–ç•¥è¯¦ç»†ä¿¡æ¯å¼‚å¸¸: ${error.message}`);
            }
        }

        // åŠ è½½ç­–ç•¥é…ç½®å‚æ•°
        async function loadStrategyConfig() {
            try {
                // ä»é…ç½®ä¸­è·å–ç­–ç•¥å‚æ•°ï¼ˆè¿™é‡Œæš‚æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼‰
                if (strategyName === 'shfe_quant') {
                    document.getElementById('param-ma-short').textContent = '5';
                    document.getElementById('param-ma-long').textContent = '20';
                    document.getElementById('param-rsi-period').textContent = '14';
                    document.getElementById('param-rsi-overbought').textContent = '70';
                    document.getElementById('strategy-symbol').textContent = 'au2507';
                    document.getElementById('strategy-max-pos').textContent = '1æ‰‹';
                    document.getElementById('strategy-risk').textContent = 'é«˜';
                }

                addLogEntry('INFO', 'ç­–ç•¥é…ç½®å‚æ•°åŠ è½½å®Œæˆ');
            } catch (error) {
                addLogEntry('ERROR', `åŠ è½½ç­–ç•¥é…ç½®å¤±è´¥: ${error.message}`);
            }
        }

        // å®šæœŸæ›´æ–°æ•°æ®
        function updateData() {
            loadStrategyDetails();
        }

        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            addLogEntry('INFO', `ç­–ç•¥ç›‘æ§é¡µé¢åˆå§‹åŒ–å®Œæˆ: ${strategyName}`);

            // åŠ è½½åˆå§‹æ•°æ®
            await loadStrategyDetails();
            await loadStrategyConfig();

            // æ¯10ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®
            setInterval(updateData, 10000);
        }
        




        // å‚æ•°ç¼–è¾‘åŠŸèƒ½
        function showParamEditModal() {
            // åŠ è½½å½“å‰å‚æ•°å€¼
            document.getElementById('edit-ma-short').value = document.getElementById('param-ma-short').textContent;
            document.getElementById('edit-ma-long').value = document.getElementById('param-ma-long').textContent;
            document.getElementById('edit-rsi-period').value = document.getElementById('param-rsi-period').textContent;
            document.getElementById('edit-rsi-overbought').value = document.getElementById('param-rsi-overbought').textContent;
            document.getElementById('edit-stop-loss').value = parseFloat(document.getElementById('param-stop-loss').textContent) * 100;
            document.getElementById('edit-take-profit').value = parseFloat(document.getElementById('param-take-profit').textContent) * 100;
            document.getElementById('edit-position-size').value = document.getElementById('param-position-size').textContent;
            document.getElementById('edit-max-position').value = document.getElementById('param-max-position').textContent;
            document.getElementById('edit-risk-factor').value = document.getElementById('param-risk-factor').textContent;
            document.getElementById('edit-add-interval').value = document.getElementById('param-add-interval').textContent;

            // è®¾ç½®å¼€ä»“æ¨¡å¼é€‰æ‹©
            const positionModeText = document.getElementById('param-position-mode').textContent;
            const positionModeMap = {
                'å›ºå®šæ‰‹æ•°': 'fixed',
                'é£é™©æ¯”ä¾‹': 'risk_based',
                'å‡¯åˆ©å…¬å¼': 'kelly',
                'é©¬ä¸æ ¼å°”': 'martingale'
            };
            document.getElementById('edit-position-mode').value = positionModeMap[positionModeText] || 'fixed';
            document.getElementById('edit-position-multiplier').value = document.getElementById('param-position-multiplier').textContent;

            document.getElementById('paramEditModal').style.display = 'block';
        }

        function closeParamModal() {
            document.getElementById('paramEditModal').style.display = 'none';
        }

        function closeBacktestModal() {
            document.getElementById('backtestModal').style.display = 'none';
        }

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // å…³é—­æ‰€æœ‰æ‰“å¼€çš„æ¨¡æ€æ¡†
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });

        async function saveStrategyParams() {
            const params = {
                ma_short: parseInt(document.getElementById('edit-ma-short').value),
                ma_long: parseInt(document.getElementById('edit-ma-long').value),
                rsi_period: parseInt(document.getElementById('edit-rsi-period').value),
                rsi_overbought: parseInt(document.getElementById('edit-rsi-overbought').value),
                stop_loss: parseFloat(document.getElementById('edit-stop-loss').value) / 100,
                take_profit: parseFloat(document.getElementById('edit-take-profit').value) / 100,
                position_size: parseInt(document.getElementById('edit-position-size').value),
                max_position: parseInt(document.getElementById('edit-max-position').value),
                risk_factor: parseFloat(document.getElementById('edit-risk-factor').value),
                add_interval: parseInt(document.getElementById('edit-add-interval').value),
                position_mode: document.getElementById('edit-position-mode').value,
                position_multiplier: parseFloat(document.getElementById('edit-position-multiplier').value)
            };

            try {
                addLogEntry('INFO', 'æ­£åœ¨ä¿å­˜ç­–ç•¥å‚æ•°...');

                const response = await fetch(`${API_BASE}/strategies/${strategyName}/params`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(params)
                });

                const result = await response.json();

                if (result.success) {
                    addLogEntry('INFO', 'ç­–ç•¥å‚æ•°ä¿å­˜æˆåŠŸ');
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    document.getElementById('param-ma-short').textContent = params.ma_short;
                    document.getElementById('param-ma-long').textContent = params.ma_long;
                    document.getElementById('param-rsi-period').textContent = params.rsi_period;
                    document.getElementById('param-rsi-overbought').textContent = params.rsi_overbought;
                    document.getElementById('param-stop-loss').textContent = params.stop_loss.toFixed(3);
                    document.getElementById('param-take-profit').textContent = params.take_profit.toFixed(3);
                    document.getElementById('param-position-size').textContent = params.position_size;
                    document.getElementById('param-max-position').textContent = params.max_position;
                    document.getElementById('param-risk-factor').textContent = params.risk_factor.toFixed(3);
                    document.getElementById('param-add-interval').textContent = params.add_interval;

                    // æ›´æ–°å¼€ä»“æ¨¡å¼æ˜¾ç¤º
                    const positionModeTextMap = {
                        'fixed': 'å›ºå®šæ‰‹æ•°',
                        'risk_based': 'é£é™©æ¯”ä¾‹',
                        'kelly': 'å‡¯åˆ©å…¬å¼',
                        'martingale': 'é©¬ä¸æ ¼å°”'
                    };
                    document.getElementById('param-position-mode').textContent = positionModeTextMap[params.position_mode] || 'å›ºå®šæ‰‹æ•°';
                    document.getElementById('param-position-multiplier').textContent = params.position_multiplier.toFixed(1);

                    // æ›´æ–°å½“å‰æ¨¡å¼æè¿°
                    updateCurrentModeDescription(params.position_mode);

                    closeParamModal();
                } else {
                    addLogEntry('ERROR', `å‚æ•°ä¿å­˜å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                addLogEntry('ERROR', `å‚æ•°ä¿å­˜å¼‚å¸¸: ${error.message}`);
            }
        }

        // å›æµ‹åŠŸèƒ½
        function showBacktestModal() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date();
            const oneMonthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

            document.getElementById('backtest-end-date').value = today.toISOString().split('T')[0];
            document.getElementById('backtest-start-date').value = oneMonthAgo.toISOString().split('T')[0];

            document.getElementById('backtestModal').style.display = 'block';
            document.getElementById('backtest-results').style.display = 'none';
        }

        function closeBacktestModal() {
            document.getElementById('backtestModal').style.display = 'none';
        }

        async function startBacktest() {
            const backtestParams = {
                strategy_name: strategyName,
                start_date: document.getElementById('backtest-start-date').value,
                end_date: document.getElementById('backtest-end-date').value,
                initial_capital: parseFloat(document.getElementById('backtest-initial-capital').value),
                commission_rate: parseFloat(document.getElementById('backtest-commission').value) / 100
            };

            try {
                addLogEntry('INFO', 'æ­£åœ¨å¯åŠ¨å†å²å›æµ‹...');

                const response = await fetch(`${API_BASE}/strategies/${strategyName}/backtest`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(backtestParams)
                });

                const result = await response.json();

                if (result.success) {
                    addLogEntry('INFO', 'å›æµ‹å®Œæˆï¼Œæ­£åœ¨æ˜¾ç¤ºç»“æœ...');
                    displayBacktestResults(result.data);
                } else {
                    addLogEntry('ERROR', `å›æµ‹å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                addLogEntry('ERROR', `å›æµ‹å¼‚å¸¸: ${error.message}`);
            }
        }

        function displayBacktestResults(results) {
            // æ˜¾ç¤ºå›æµ‹ç»“æœ
            document.getElementById('backtest-total-return').textContent = `${(results.total_return * 100).toFixed(2)}%`;
            document.getElementById('backtest-annual-return').textContent = `${(results.annual_return * 100).toFixed(2)}%`;
            document.getElementById('backtest-max-drawdown').textContent = `${(results.max_drawdown * 100).toFixed(2)}%`;
            document.getElementById('backtest-sharpe').textContent = results.sharpe_ratio.toFixed(2);
            document.getElementById('backtest-win-rate').textContent = `${(results.win_rate * 100).toFixed(2)}%`;
            document.getElementById('backtest-trade-count').textContent = results.trade_count;

            document.getElementById('backtest-results').style.display = 'block';
        }

        // è§¦å‘è®°å½•åŠŸèƒ½
        function clearTriggerRecords() {
            if (confirm('ç¡®è®¤æ¸…ç©ºæ‰€æœ‰è§¦å‘è®°å½•ï¼Ÿ')) {
                document.getElementById('trigger-records').innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">æš‚æ— è§¦å‘è®°å½•</div>';
                addLogEntry('INFO', 'è§¦å‘è®°å½•å·²æ¸…ç©º');
            }
        }

        function addTriggerRecord(time, condition, action, result) {
            const triggerContainer = document.getElementById('trigger-records');
            const triggerItem = document.createElement('div');
            triggerItem.className = 'trigger-item';

            const resultClass = result.includes('æˆåŠŸ') ? 'success' : result.includes('æ­¢æŸ') ? 'warning' : 'error';

            triggerItem.innerHTML = `
                <div class="trigger-time">${time}</div>
                <div class="trigger-condition"><strong>${condition}</strong></div>
                <div class="trigger-action">${action}</div>
                <div class="trigger-result ${resultClass}">${result}</div>
            `;

            // æ’å…¥åˆ°æœ€å‰é¢
            triggerContainer.insertBefore(triggerItem, triggerContainer.firstChild);

            // é™åˆ¶è®°å½•æ•°é‡ï¼Œä¿ç•™æœ€æ–°çš„20æ¡
            const items = triggerContainer.querySelectorAll('.trigger-item');
            if (items.length > 20) {
                triggerContainer.removeChild(items[items.length - 1]);
            }
        }

        // æµ‹è¯•å¼€ä»“æ¨¡å¼æ•ˆæœ
        function testPositionMode() {
            const mode = document.getElementById('edit-position-mode').value;
            const positionSize = parseInt(document.getElementById('edit-position-size').value);
            const riskFactor = parseFloat(document.getElementById('edit-risk-factor').value);
            const multiplier = parseFloat(document.getElementById('edit-position-multiplier').value);

            // æ¨¡æ‹Ÿä¸åŒæ¨¡å¼çš„è®¡ç®—ç»“æœ
            let calculatedPosition = positionSize;
            let explanation = '';

            switch(mode) {
                case 'fixed':
                    calculatedPosition = positionSize * multiplier;
                    explanation = `å›ºå®šæ‰‹æ•°: ${positionSize} Ã— ${multiplier} = ${calculatedPosition}æ‰‹`;
                    break;
                case 'risk_based':
                    const accountBalance = 100000; // å‡è®¾è´¦æˆ·ä½™é¢
                    const riskAmount = accountBalance * riskFactor;
                    const pricePerLot = 435 * 1000; // å‡è®¾ä»·æ ¼å’Œæ¯æ‰‹æ•°é‡
                    const riskPerLot = pricePerLot * 0.05; // å‡è®¾5%æ­¢æŸ
                    calculatedPosition = Math.floor(riskAmount / riskPerLot * multiplier);
                    explanation = `é£é™©æ¯”ä¾‹: è´¦æˆ·${accountBalance} Ã— ${riskFactor} Ã· æ¯æ‰‹é£é™©${riskPerLot.toFixed(0)} Ã— ${multiplier} = ${calculatedPosition}æ‰‹`;
                    break;
                case 'kelly':
                    const winRate = 0.6;
                    const avgWin = 1.5;
                    const avgLoss = 1.0;
                    const kellyFraction = (avgWin * winRate - (1 - winRate)) / avgWin;
                    calculatedPosition = Math.floor(kellyFraction * 10 * multiplier); // ç®€åŒ–è®¡ç®—
                    explanation = `å‡¯åˆ©å…¬å¼: èƒœç‡${winRate} Ã— ç›ˆäºæ¯”${avgWin} = å‡¯åˆ©æ¯”ä¾‹${kellyFraction.toFixed(3)} â†’ ${calculatedPosition}æ‰‹`;
                    break;
                case 'martingale':
                    const consecutiveLosses = 2; // å‡è®¾è¿ç»­äºæŸ2æ¬¡
                    const martingaleMultiplier = Math.pow(2, consecutiveLosses);
                    calculatedPosition = Math.floor(positionSize * martingaleMultiplier * multiplier);
                    explanation = `é©¬ä¸æ ¼å°”: ${positionSize} Ã— 2^${consecutiveLosses} Ã— ${multiplier} = ${calculatedPosition}æ‰‹`;
                    break;
            }

            // æ˜¾ç¤ºè®¡ç®—ç»“æœ
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = `
                margin-top: 10px;
                padding: 10px;
                background: rgba(46, 204, 113, 0.1);
                border-left: 3px solid #2ecc71;
                border-radius: 4px;
                font-size: 12px;
                color: #27ae60;
            `;
            resultDiv.innerHTML = `
                <strong>ğŸ’¡ è®¡ç®—ç»“æœ:</strong><br>
                ${explanation}<br>
                <strong>å»ºè®®å¼€ä»“: ${calculatedPosition}æ‰‹</strong>
            `;

            // ç§»é™¤ä¹‹å‰çš„ç»“æœ
            const existingResult = document.getElementById('position-test-result');
            if (existingResult) {
                existingResult.remove();
            }

            // æ·»åŠ æ–°ç»“æœ
            resultDiv.id = 'position-test-result';
            document.getElementById('position-mode-description').parentNode.appendChild(resultDiv);

            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (document.getElementById('position-test-result')) {
                    document.getElementById('position-test-result').remove();
                }
            }, 5000);
        }

        // æ›´æ–°å¼€ä»“æ¨¡å¼æè¿°
        function updatePositionModeDescription() {
            const mode = document.getElementById('edit-position-mode').value;
            const descriptionDiv = document.getElementById('position-mode-description');

            const descriptions = {
                'fixed': {
                    title: 'å›ºå®šæ‰‹æ•°',
                    risk: 'low',
                    description: 'æ¯æ¬¡å¼€ä»“ä½¿ç”¨å›ºå®šçš„æ‰‹æ•°ï¼Œç®€å•ç¨³å®šï¼Œé€‚åˆæ–°æ‰‹å’Œä¿å®ˆç­–ç•¥ã€‚',
                    features: [
                        'é£é™©å¯æ§ï¼Œæ˜“äºç†è§£',
                        'é€‚åˆç¨³å®šç›ˆåˆ©çš„ç­–ç•¥',
                        'ä¸å—è´¦æˆ·èµ„é‡‘å˜åŒ–å½±å“',
                        'é€‚åˆæ–°æ‰‹äº¤æ˜“è€…'
                    ]
                },
                'risk_based': {
                    title: 'é£é™©æ¯”ä¾‹',
                    risk: 'medium',
                    description: 'æ ¹æ®è´¦æˆ·èµ„é‡‘çš„å›ºå®šæ¯”ä¾‹æ¥è®¡ç®—å¼€ä»“æ‰‹æ•°ï¼Œèµ„é‡‘å¢é•¿æ—¶ä»“ä½è‡ªåŠ¨å¢åŠ ã€‚',
                    features: [
                        'ä»“ä½éšèµ„é‡‘è§„æ¨¡åŠ¨æ€è°ƒæ•´',
                        'æœ‰æ•ˆæ§åˆ¶å•ç¬”äº¤æ˜“é£é™©',
                        'é€‚åˆé•¿æœŸèµ„é‡‘å¢é•¿',
                        'éœ€è¦è®¾ç½®åˆç†çš„é£é™©æ¯”ä¾‹'
                    ]
                },
                'kelly': {
                    title: 'å‡¯åˆ©å…¬å¼',
                    risk: 'medium',
                    description: 'åŸºäºå†å²èƒœç‡å’Œç›ˆäºæ¯”è®¡ç®—æœ€ä¼˜ä»“ä½ï¼Œç†è®ºä¸Šèƒ½æœ€å¤§åŒ–é•¿æœŸæ”¶ç›Šã€‚',
                    features: [
                        'ç†è®ºæœ€ä¼˜ä»“ä½è®¡ç®—',
                        'éœ€è¦å‡†ç¡®çš„èƒœç‡ç»Ÿè®¡',
                        'é€‚åˆæœ‰å†å²æ•°æ®çš„ç­–ç•¥',
                        'å¯èƒ½äº§ç”Ÿè¾ƒå¤§ä»“ä½æ³¢åŠ¨'
                    ]
                },
                'martingale': {
                    title: 'é©¬ä¸æ ¼å°”',
                    risk: 'high',
                    description: 'äºæŸååŠ å€ä¸‹æ³¨ï¼Œç›ˆåˆ©åå›åˆ°åŸºç¡€ä»“ä½ã€‚é«˜é£é™©é«˜æ”¶ç›Šç­–ç•¥ã€‚',
                    features: [
                        'äºæŸåè‡ªåŠ¨åŠ ä»“',
                        'ç†è®ºä¸Šå¿…ç„¶ç›ˆåˆ©',
                        'éœ€è¦å……è¶³çš„èµ„é‡‘æ”¯æŒ',
                        'æé«˜é£é™©ï¼Œè°¨æ…ä½¿ç”¨'
                    ]
                }
            };

            const info = descriptions[mode];
            const riskLevelText = {
                'low': 'ä½é£é™©',
                'medium': 'ä¸­ç­‰é£é™©',
                'high': 'é«˜é£é™©'
            };

            descriptionDiv.innerHTML = `
                <strong>${info.title}:</strong> ${info.description}
                <span class="risk-level risk-${info.risk}">${riskLevelText[info.risk]}</span>
                <div class="mode-features">
                    <ul>
                        ${info.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // æ›´æ–°å½“å‰æ¨¡å¼æè¿°ï¼ˆç”¨äºç­–ç•¥å‚æ•°æ˜¾ç¤ºåŒºåŸŸï¼‰
        function updateCurrentModeDescription(mode) {
            const descriptions = {
                'fixed': {
                    title: 'å›ºå®šæ‰‹æ•°',
                    risk: 'low',
                    description: 'æ¯æ¬¡å¼€ä»“ä½¿ç”¨å›ºå®šçš„æ‰‹æ•°ï¼Œç®€å•ç¨³å®šï¼Œé€‚åˆæ–°æ‰‹å’Œä¿å®ˆç­–ç•¥ã€‚'
                },
                'risk_based': {
                    title: 'é£é™©æ¯”ä¾‹',
                    risk: 'medium',
                    description: 'æ ¹æ®è´¦æˆ·èµ„é‡‘çš„å›ºå®šæ¯”ä¾‹æ¥è®¡ç®—å¼€ä»“æ‰‹æ•°ï¼Œèµ„é‡‘å¢é•¿æ—¶ä»“ä½è‡ªåŠ¨å¢åŠ ã€‚'
                },
                'kelly': {
                    title: 'å‡¯åˆ©å…¬å¼',
                    risk: 'medium',
                    description: 'åŸºäºå†å²èƒœç‡å’Œç›ˆäºæ¯”è®¡ç®—æœ€ä¼˜ä»“ä½ï¼Œç†è®ºä¸Šèƒ½æœ€å¤§åŒ–é•¿æœŸæ”¶ç›Šã€‚'
                },
                'martingale': {
                    title: 'é©¬ä¸æ ¼å°”',
                    risk: 'high',
                    description: 'äºæŸååŠ å€ä¸‹æ³¨ï¼Œç›ˆåˆ©åå›åˆ°åŸºç¡€ä»“ä½ã€‚é«˜é£é™©é«˜æ”¶ç›Šç­–ç•¥ã€‚'
                }
            };

            const info = descriptions[mode] || descriptions['fixed'];
            const riskLevelText = {
                'low': 'ä½é£é™©',
                'medium': 'ä¸­ç­‰é£é™©',
                'high': 'é«˜é£é™©'
            };

            const currentDescDiv = document.getElementById('current-mode-description');
            if (currentDescDiv) {
                currentDescDiv.innerHTML = `
                    <strong>${info.title}:</strong> ${info.description}
                    <span class="risk-level risk-${info.risk}">${riskLevelText[info.risk]}</span>
                `;
            }
        }

        // æ¨¡æ€æ¡†æ‹–åŠ¨åŠŸèƒ½
        function makeDraggable(modal) {
            const modalContent = modal.querySelector('.modal-content');
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            modalContent.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            function dragStart(e) {
                // åªæœ‰ç‚¹å‡»æ¨¡æ€æ¡†å¤´éƒ¨åŒºåŸŸæ‰èƒ½æ‹–åŠ¨
                if (e.target.closest('.close') || e.target.closest('input') || e.target.closest('select') || e.target.closest('button')) {
                    return;
                }

                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;

                if (e.target === modalContent || e.target.closest('h3')) {
                    isDragging = true;
                    modalContent.style.cursor = 'grabbing';
                }
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;

                    xOffset = currentX;
                    yOffset = currentY;

                    // é™åˆ¶æ‹–åŠ¨èŒƒå›´
                    const rect = modalContent.getBoundingClientRect();
                    const maxX = window.innerWidth - rect.width;
                    const maxY = window.innerHeight - rect.height;

                    xOffset = Math.max(0, Math.min(maxX, xOffset));
                    yOffset = Math.max(0, Math.min(maxY, yOffset));

                    modalContent.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
                }
            }

            function dragEnd() {
                if (isDragging) {
                    isDragging = false;
                    modalContent.style.cursor = 'move';
                }
            }

            // é‡ç½®ä½ç½®
            function resetPosition() {
                xOffset = 0;
                yOffset = 0;
                modalContent.style.transform = 'translate(0px, 0px)';
            }

            // å½“æ¨¡æ€æ¡†æ˜¾ç¤ºæ—¶é‡ç½®ä½ç½®
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        if (modal.style.display === 'block') {
                            resetPosition();
                        }
                    }
                });
            });

            observer.observe(modal, { attributes: true });
        }

        // å‚æ•°è¯´æ˜æŠ˜å åŠŸèƒ½
        function toggleParamHelp() {
            const content = document.getElementById('param-help-content');
            const toggle = document.getElementById('param-help-toggle');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¶';
            }
        }

        // åŠ è½½ç­–ç•¥å‚æ•°
        async function loadStrategyParams() {
            try {
                const response = await fetch(`${API_BASE}/strategies/${strategyName}/params`);
                const result = await response.json();

                if (result.success && result.data) {
                    const params = result.data;

                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    document.getElementById('param-ma-short').textContent = params.ma_short || 5;
                    document.getElementById('param-ma-long').textContent = params.ma_long || 20;
                    document.getElementById('param-rsi-period').textContent = params.rsi_period || 14;
                    document.getElementById('param-rsi-overbought').textContent = params.rsi_overbought || 70;
                    document.getElementById('param-stop-loss').textContent = (params.stop_loss || 0.05).toFixed(3);
                    document.getElementById('param-take-profit').textContent = (params.take_profit || 0.08).toFixed(3);
                    document.getElementById('param-position-size').textContent = params.position_size || 1;
                    document.getElementById('param-max-position').textContent = params.max_position || 5;
                    document.getElementById('param-risk-factor').textContent = (params.risk_factor || 0.02).toFixed(3);
                    document.getElementById('param-add-interval').textContent = params.add_interval || 50;

                    // æ›´æ–°å¼€ä»“æ¨¡å¼æ˜¾ç¤º
                    const positionModeTextMap = {
                        'fixed': 'å›ºå®šæ‰‹æ•°',
                        'risk_based': 'é£é™©æ¯”ä¾‹',
                        'kelly': 'å‡¯åˆ©å…¬å¼',
                        'martingale': 'é©¬ä¸æ ¼å°”'
                    };
                    document.getElementById('param-position-mode').textContent = positionModeTextMap[params.position_mode] || 'å›ºå®šæ‰‹æ•°';
                    document.getElementById('param-position-multiplier').textContent = (params.position_multiplier || 1.0).toFixed(1);

                    // æ›´æ–°å½“å‰æ¨¡å¼æè¿°
                    updateCurrentModeDescription(params.position_mode || 'fixed');

                    console.log('ç­–ç•¥å‚æ•°åŠ è½½æˆåŠŸ:', params);
                }
            } catch (error) {
                console.error('åŠ è½½ç­–ç•¥å‚æ•°å¤±è´¥:', error);
                addLogEntry('ERROR', 'åŠ è½½ç­–ç•¥å‚æ•°å¤±è´¥');
            }
        }

        // æ¨¡æ‹Ÿè§¦å‘è®°å½•ç”Ÿæˆå™¨
        function generateMockTriggerRecord() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN');

            const mockRecords = [
                {
                    condition: 'ä¹°å…¥ä¿¡å·: MA5(435.8) > MA20(434.2), RSI(28.5) < 30',
                    action: 'æ‰§è¡Œæ“ä½œ: ä¹°å…¥ au2507 1æ‰‹ @ 435.9 (å¼€ä»“æ‰‹æ•°: 1, é£é™©ç³»æ•°: 0.02)',
                    result: 'âœ… è®¢å•å·²æˆäº¤'
                },
                {
                    condition: 'å–å‡ºä¿¡å·: MA5(433.1) < MA20(433.8), RSI(72.3) > 70',
                    action: 'æ‰§è¡Œæ“ä½œ: å–å‡º au2507 1æ‰‹ @ 433.0 (å¹³ä»“æ“ä½œ, æ­¢ç›ˆ: 8%)',
                    result: 'âœ… è®¢å•å·²æˆäº¤'
                },
                {
                    condition: 'æ­¢æŸä¿¡å·: ä»·æ ¼(432.5) < æ­¢æŸä»·(432.8)',
                    action: 'æ‰§è¡Œæ“ä½œ: æ­¢æŸå¹³ä»“ au2507 1æ‰‹ @ 432.5 (æ­¢æŸ: 5%, äºæŸ: -0.4ç‚¹)',
                    result: 'âš ï¸ æ­¢æŸæ‰§è¡Œ'
                },
                {
                    condition: 'åŠ ä»“ä¿¡å·: ä»·æ ¼çªç ´(436.2), å½“å‰æŒä»“æœ‰åˆ©',
                    action: 'æ‰§è¡Œæ“ä½œ: åŠ ä»“ä¹°å…¥ au2507 1æ‰‹ @ 436.3 (åŠ ä»“é—´éš”: 50ç‚¹)',
                    result: 'âœ… åŠ ä»“æˆåŠŸ'
                }
            ];

            const record = mockRecords[Math.floor(Math.random() * mockRecords.length)];
            addTriggerRecord(timeStr, record.condition, record.action, record.result);
        }

        // æ›´æ–°ç­–ç•¥æ€§èƒ½æ•°æ®
        function updateStrategyPerformance() {
            // æ¨¡æ‹Ÿæ€§èƒ½æ•°æ®å˜åŒ–
            const baseValues = {
                totalPnL: -2860,
                todayPnL: 150,
                position: 0,
                winRate: 0.65,
                totalTrades: 28,
                maxDrawdown: 0.08
            };

            // æ·»åŠ éšæœºæ³¢åŠ¨
            const variation = (Math.random() - 0.5) * 0.1; // Â±5%çš„æ³¢åŠ¨

            const newTotalPnL = baseValues.totalPnL + (Math.random() - 0.5) * 200;
            const newTodayPnL = baseValues.todayPnL + (Math.random() - 0.5) * 100;
            const newPosition = Math.floor((Math.random() - 0.5) * 6); // -3åˆ°3çš„æŒä»“

            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            const totalPnLElement = document.querySelector('.metric-card:nth-child(1) .metric-value');
            const todayPnLElement = document.querySelector('.metric-card:nth-child(2) .metric-value');
            const positionElement = document.querySelector('.metric-card:nth-child(3) .metric-value');
            const winRateElement = document.querySelector('.metric-card:nth-child(4) .metric-value');

            if (totalPnLElement) {
                totalPnLElement.textContent = `Â¥${newTotalPnL.toFixed(2)}`;
                totalPnLElement.className = `metric-value ${newTotalPnL >= 0 ? 'positive' : 'negative'}`;
            }

            if (todayPnLElement) {
                todayPnLElement.textContent = `Â¥${newTodayPnL.toFixed(2)}`;
                todayPnLElement.className = `metric-value ${newTodayPnL >= 0 ? 'positive' : 'negative'}`;
            }

            if (positionElement) {
                positionElement.textContent = `${newPosition}æ‰‹`;
                positionElement.className = `metric-value ${newPosition > 0 ? 'positive' : newPosition < 0 ? 'negative' : ''}`;
            }

            if (winRateElement) {
                const newWinRate = Math.max(0.4, Math.min(0.8, baseValues.winRate + variation));
                winRateElement.textContent = `${(newWinRate * 100).toFixed(1)}%`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initPage();

            // åŠ è½½ç­–ç•¥å‚æ•°
            loadStrategyParams();

            // ä¸ºæ‰€æœ‰æ¨¡æ€æ¡†æ·»åŠ æ‹–åŠ¨åŠŸèƒ½
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                makeDraggable(modal);
            });

            // æ¯30ç§’ç”Ÿæˆä¸€ä¸ªæ¨¡æ‹Ÿè§¦å‘è®°å½•
            setInterval(generateMockTriggerRecord, 30000);

            // æ¯10ç§’æ›´æ–°ç­–ç•¥æ€§èƒ½æ•°æ®
            setInterval(updateStrategyPerformance, 10000);
        });
    </script>
</body>
</html>
