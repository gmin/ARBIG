# ARBIG交易时间功能测试计划

## 📅 测试时间安排

### 🌅 **交易时间段**
- **上午**: 09:00-10:15, 10:30-11:30
- **下午**: 13:30-15:00  
- **夜盘**: 21:00-02:30 (次日)

### ⚠️ **注意事项**
- 测试必须在交易时间内进行
- 建议使用模拟账户进行测试
- 准备少量资金进行小额测试
- 确保有实时行情数据

## 🧪 交易时间测试清单

### 1. **CTP连接测试** ⭐⭐⭐
- [ ] CTP Gateway连接状态
- [ ] 行情数据接收
- [ ] 交易接口连接
- [ ] 账户信息获取
- [ ] 合约信息查询

**测试命令**:
```bash
# 启动交易服务并观察CTP连接日志
cd /root/ARBIG/services/trading_service
conda activate vnpy
python main.py

# 检查连接状态
curl http://localhost:8001/real_trading/status
```

### 2. **实时行情数据测试** ⭐⭐⭐
- [ ] tick数据接收
- [ ] 行情数据完整性
- [ ] 数据延迟测试
- [ ] 数据存储验证
- [ ] WebSocket推送测试

**测试方法**:
```bash
# 查看实时行情
curl http://localhost:8001/real_trading/market_data

# 检查数据库中的行情记录
mysql -u root -p arbig_db -e "SELECT * FROM market_data ORDER BY datetime DESC LIMIT 10;"
```

### 3. **账户和持仓数据测试** ⭐⭐⭐
- [ ] 账户余额查询
- [ ] 持仓信息获取
- [ ] 可用资金计算
- [ ] 今仓/昨仓区分
- [ ] 持仓盈亏计算

**测试API**:
```bash
curl http://localhost:8001/real_trading/account
curl http://localhost:8001/real_trading/positions
```

### 4. **手动交易功能测试** ⭐⭐⭐
- [ ] 开仓下单 (买入/卖出)
- [ ] 平仓下单 (今仓/昨仓)
- [ ] 订单状态查询
- [ ] 订单撤销
- [ ] 成交回报处理

**测试步骤**:
1. 通过Web界面下小额测试单
2. 验证订单状态更新
3. 检查持仓变化
4. 验证资金变动

### 5. **智能平仓功能测试** ⭐⭐⭐
- [ ] 今仓优先平仓逻辑
- [ ] 昨仓平仓逻辑  
- [ ] 混合持仓平仓
- [ ] 平仓数量计算
- [ ] 手续费优化验证

**测试场景**:
- 只有今仓时平仓
- 只有昨仓时平仓
- 今昨仓混合时平仓
- 部分平仓测试

### 6. **策略执行测试** ⭐⭐
- [ ] 策略注册和启动
- [ ] 实时数据接收
- [ ] 信号生成测试
- [ ] 交易执行验证
- [ ] 策略状态监控

**测试策略**:
```bash
# 启动策略服务
cd /root/ARBIG/services/strategy_service  
python main.py

# 注册测试策略
curl -X POST http://localhost:8002/strategies/register \
  -H "Content-Type: application/json" \
  -d '{
    "strategy_type": "TestStrategy",
    "strategy_name": "test_001", 
    "symbol": "au2412",
    "settings": {"trade_volume": 1}
  }'

# 启动策略
curl -X POST http://localhost:8002/strategies/test_001/start
```

### 7. **Web管理界面测试** ⭐⭐
- [ ] 实时持仓显示
- [ ] 交易历史查询
- [ ] 策略状态监控
- [ ] 手动交易操作
- [ ] 系统状态监控

**访问地址**: http://localhost:80

### 8. **风险控制测试** ⭐⭐
- [ ] 持仓限制检查
- [ ] 资金充足性验证
- [ ] 异常订单拦截
- [ ] 紧急停止功能
- [ ] 风险预警机制

### 9. **数据完整性测试** ⭐
- [ ] 订单数据存储
- [ ] 成交数据记录
- [ ] 持仓数据更新
- [ ] 资金流水记录
- [ ] 策略执行日志

### 10. **异常处理测试** ⭐
- [ ] 网络断线恢复
- [ ] 服务重启恢复
- [ ] 异常订单处理
- [ ] 数据不一致修复
- [ ] 错误日志记录

## 🚨 测试注意事项

### **安全措施**
1. **使用模拟账户**: 首次测试必须使用模拟环境
2. **小额测试**: 实盘测试使用最小交易单位
3. **备份数据**: 测试前备份重要数据
4. **监控日志**: 实时查看系统日志
5. **应急预案**: 准备紧急停止程序

### **测试顺序**
1. 先测试CTP连接和行情数据
2. 验证账户和持仓查询
3. 进行小额手动交易测试
4. 测试智能平仓功能
5. 最后测试策略自动执行

### **问题记录**
测试过程中发现的问题请记录到:
- 日志文件: `/root/ARBIG/logs/`
- 问题清单: `TRADING_TEST_ISSUES.md`

## 📊 测试报告模板

```markdown
# ARBIG交易时间测试报告

**测试日期**: YYYY-MM-DD
**测试时间段**: HH:MM - HH:MM  
**测试环境**: [模拟/实盘]
**测试人员**: 

## 测试结果总览
- 总测试项: XX项
- 通过项: XX项  
- 失败项: XX项
- 成功率: XX%

## 详细测试结果
[逐项记录测试结果]

## 发现的问题
[记录所有发现的问题和异常]

## 修复建议
[提出修复和改进建议]
```

## 🔄 后续优化计划

根据测试结果，可能需要优化的方面:

1. **性能优化**: 延迟、吞吐量、内存使用
2. **稳定性改进**: 异常处理、容错机制
3. **功能完善**: 新增功能、用户体验
4. **监控增强**: 更全面的系统监控
5. **文档完善**: 操作手册、故障排除指南
