# ARBIG WebæŒ‡æŒ¥ä¸­è½´æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-01-04
- **æœ€åæ›´æ–°**: 2025-01-04
- **ä½œè€…**: ARBIGå¼€å‘å›¢é˜Ÿ

## ğŸ¯ è®¾è®¡ç›®æ ‡

å°†ARBIGç³»ç»Ÿé‡æ„ä¸º**WebæŒ‡æŒ¥ä¸­è½´**æ¶æ„ï¼Œå®ç°ï¼š
- Webç•Œé¢æˆä¸ºç³»ç»Ÿçš„ç»Ÿä¸€æ§åˆ¶ä¸­å¿ƒ
- main.pyè½¬å˜ä¸ºçº¯ç²¹çš„æœåŠ¡å®¹å™¨
- ç”¨æˆ·é€šè¿‡Webç•Œé¢å®Œæˆæ‰€æœ‰æ“ä½œå’Œç›‘æ§

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### ä¼ ç»Ÿæ¶æ„ vs æ–°æ¶æ„

#### âŒ ä¼ ç»Ÿæ¶æ„ï¼ˆå½“å‰ï¼‰
```
main.py (ä¸»æ§åˆ¶å™¨)
    â”œâ”€â”€ å¯åŠ¨æ‰€æœ‰æœåŠ¡
    â”œâ”€â”€ ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸ
    â”œâ”€â”€ å¤„ç†ç­–ç•¥é€»è¾‘
    â””â”€â”€ Webä»…ä½œä¸ºç›‘æ§ç•Œé¢
```

#### âœ… æ–°æ¶æ„ï¼ˆWebæŒ‡æŒ¥ä¸­è½´ï¼‰
```
WebæŒ‡æŒ¥ä¸­è½´ (æ§åˆ¶ä¸­å¿ƒ)
    â”œâ”€â”€ ç³»ç»Ÿæ§åˆ¶å°
    â”œâ”€â”€ å®æ—¶ç›‘æ§
    â”œâ”€â”€ ç­–ç•¥ç®¡ç†
    â”œâ”€â”€ æ•°æ®åˆ†æ
    â””â”€â”€ ç”¨æˆ·äº¤äº’
         â”‚
         â–¼ (APIè°ƒç”¨)
main.py (æœåŠ¡å®¹å™¨)
    â”œâ”€â”€ æœåŠ¡ç®¡ç†å™¨
    â”œâ”€â”€ APIæä¾›è€…
    â”œâ”€â”€ çŠ¶æ€æŠ¥å‘Šå™¨
    â””â”€â”€ å‘½ä»¤æ‰§è¡Œå™¨
         â”‚
         â–¼
æ ¸å¿ƒæœåŠ¡å±‚
    â”œâ”€â”€ MarketDataService
    â”œâ”€â”€ AccountService
    â”œâ”€â”€ RiskService
    â””â”€â”€ TradingService
         â”‚
         â–¼
CTP Gateway
```

## ğŸ® WebæŒ‡æŒ¥ä¸­è½´åŠŸèƒ½æ¨¡å—

### 1. ç³»ç»Ÿæ§åˆ¶å°
**èŒè´£**: ç³»ç»Ÿçº§æ“ä½œå’Œæ§åˆ¶

**åŠŸèƒ½åˆ—è¡¨**:
- âœ… æœåŠ¡å¯åŠ¨/åœæ­¢/é‡å¯
- âœ… è¿è¡Œæ¨¡å¼åˆ‡æ¢
- âœ… ç³»ç»Ÿå‚æ•°é…ç½®
- âœ… ç´§æ€¥åœæ­¢/å¹³ä»“
- âœ… ç³»ç»ŸçŠ¶æ€ç›‘æ§

**ç•Œé¢ç»„ä»¶**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç³»ç»Ÿæ§åˆ¶å°    â”‚
â”‚ â—‹ è¡Œæƒ…æœåŠ¡      â”‚
â”‚ â—‹ è´¦æˆ·æœåŠ¡      â”‚
â”‚ â—‹ é£æ§æœåŠ¡      â”‚
â”‚ â—‹ äº¤æ˜“æœåŠ¡      â”‚
â”‚                 â”‚
â”‚ è¿è¡Œæ¨¡å¼: å®Œæ•´  â”‚
â”‚ [åˆ‡æ¢æ¨¡å¼]      â”‚
â”‚                 â”‚
â”‚ [ç´§æ€¥åœæ­¢]      â”‚
â”‚ [ç´§æ€¥å¹³ä»“]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å®æ—¶è¡Œæƒ…ç›‘æ§
**èŒè´£**: è¡Œæƒ…æ•°æ®å±•ç¤ºå’Œåˆ†æ

**åŠŸèƒ½åˆ—è¡¨**:
- âœ… å®æ—¶Kçº¿å›¾è¡¨
- âœ… å®æ—¶ä»·æ ¼æ˜¾ç¤º
- âœ… æˆäº¤é‡åˆ†æ
- âœ… æŠ€æœ¯æŒ‡æ ‡å±•ç¤º
- âœ… å¤šåˆçº¦ç›‘æ§

**ç•Œé¢ç»„ä»¶**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å®æ—¶è¡Œæƒ…               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚         Kçº¿å›¾è¡¨åŒºåŸŸ             â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ AU2509: 485.50 â†‘2.30 (+0.48%)     â”‚
â”‚ æˆäº¤é‡: 12,580  æŒä»“: 45,230       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ä»“ä½ç®¡ç†ä¸­å¿ƒ
**èŒè´£**: è´¦æˆ·å’ŒæŒä»“ä¿¡æ¯ç®¡ç†

**åŠŸèƒ½åˆ—è¡¨**:
- âœ… è´¦æˆ·èµ„é‡‘å±•ç¤º
- âœ… æŒä»“æ˜ç»†ç®¡ç†
- âœ… ç›ˆäºç»Ÿè®¡åˆ†æ
- âœ… é£é™©æŒ‡æ ‡ç›‘æ§
- âœ… å†å²äº¤æ˜“è®°å½•

**ç•Œé¢ç»„ä»¶**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è´¦æˆ·èµ„é‡‘            â”‚ â”‚        æŒä»“æ˜ç»†         â”‚
â”‚ æ€»èµ„äº§: Â¥1,000,000         â”‚ â”‚ AU2509 å¤š5æ‰‹            â”‚
â”‚ å¯ç”¨: Â¥850,000             â”‚ â”‚ å‡ä»·: 483.20            â”‚
â”‚ ä¿è¯é‡‘: Â¥150,000           â”‚ â”‚ ç°ä»·: 485.50            â”‚
â”‚ æµ®ç›ˆ: Â¥25,000              â”‚ â”‚ ç›ˆäº: +Â¥11,500          â”‚
â”‚ ä»Šæ—¥ç›ˆäº: +Â¥5,000          â”‚ â”‚ ä¿è¯é‡‘: Â¥120,000        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ç­–ç•¥ç®¡ç†ä¸­å¿ƒ
**èŒè´£**: ç­–ç•¥çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

**åŠŸèƒ½åˆ—è¡¨**:
- âœ… ç­–ç•¥é€‰æ‹©å’Œåˆ‡æ¢
- âœ… ç­–ç•¥å‚æ•°é…ç½®
- âœ… ç­–ç•¥è¿è¡Œç›‘æ§
- âœ… ç­–ç•¥ç»©æ•ˆåˆ†æ
- âœ… ç­–ç•¥å†å²å›æµ‹

**ç•Œé¢ç»„ä»¶**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç­–ç•¥é€‰æ‹©      â”‚ â”‚   ç­–ç•¥ç›‘æ§      â”‚ â”‚   ç­–ç•¥åˆ†æ      â”‚
â”‚ â—‹ è¶‹åŠ¿ç­–ç•¥      â”‚ â”‚ å½“å‰: å¥—åˆ©ç­–ç•¥  â”‚ â”‚ ä»Šæ—¥æ”¶ç›Š: +2.3% â”‚
â”‚ â— å¥—åˆ©ç­–ç•¥      â”‚ â”‚ è¿è¡Œ: 2h30m     â”‚ â”‚ æœ€å¤§å›æ’¤: -1.2% â”‚
â”‚ â—‹ é«˜é¢‘ç­–ç•¥      â”‚ â”‚ ä¿¡å·: 15        â”‚ â”‚ èƒœç‡: 68.5%     â”‚
â”‚ â—‹ æ— ç­–ç•¥        â”‚ â”‚ æˆäº¤: 8         â”‚ â”‚ å¤æ™®: 1.85      â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ [åˆ‡æ¢ç­–ç•¥]      â”‚ â”‚ [æš‚åœç­–ç•¥]      â”‚ â”‚ [è¯¦ç»†æŠ¥å‘Š]      â”‚
â”‚ [ç­–ç•¥å‚æ•°]      â”‚ â”‚ [é‡å¯ç­–ç•¥]      â”‚ â”‚ [å†å²å›æµ‹]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. æ•°æ®åˆ†æä¸­å¿ƒ
**èŒè´£**: å†å²æ•°æ®åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ

**åŠŸèƒ½åˆ—è¡¨**:
- âœ… äº¤æ˜“ç»©æ•ˆåˆ†æ
- âœ… é£é™©æŒ‡æ ‡è®¡ç®—
- âœ… å†å²æ•°æ®å›æµ‹
- âœ… æŠ¥è¡¨ç”Ÿæˆå¯¼å‡º
- âœ… æ•°æ®å¯è§†åŒ–

## ğŸ”§ main.pyé‡æ„è®¾è®¡

### æ–°çš„èŒè´£å®šä½
main.pyä»**ä¸»æ§åˆ¶å™¨**è½¬å˜ä¸º**æœåŠ¡å®¹å™¨**ï¼š

```python
class ARBIGServiceContainer:
    """ARBIGæœåŠ¡å®¹å™¨ - çº¯ç²¹çš„æœåŠ¡ç®¡ç†å™¨"""
    
    def __init__(self):
        """åˆå§‹åŒ–æœåŠ¡å®¹å™¨"""
        self.services = {}
        self.ctp_gateway = None
        self.event_engine = None
        self.running = False
        
    # æœåŠ¡ç®¡ç†æ¥å£
    def start_service(self, service_name: str) -> ServiceResult
    def stop_service(self, service_name: str) -> ServiceResult
    def restart_service(self, service_name: str) -> ServiceResult
    def get_service_status(self, service_name: str) -> ServiceStatus
    
    # ç³»ç»Ÿç®¡ç†æ¥å£
    def start_system(self) -> SystemResult
    def stop_system(self) -> SystemResult
    def get_system_status(self) -> SystemStatus
    
    # å‘½ä»¤æ‰§è¡Œæ¥å£
    def execute_command(self, command: Command) -> CommandResult
    
    # é…ç½®ç®¡ç†æ¥å£
    def update_config(self, config: dict) -> ConfigResult
    def get_config(self) -> dict
```

### æœåŠ¡å¯åŠ¨ç­–ç•¥
```python
def start_service(self, service_name: str) -> ServiceResult:
    """å¯åŠ¨æŒ‡å®šæœåŠ¡"""
    
    # 1. æ£€æŸ¥ä¾èµ–å…³ç³»
    if not self._check_dependencies(service_name):
        return ServiceResult(False, "ä¾èµ–æœåŠ¡æœªå¯åŠ¨")
    
    # 2. æ£€æŸ¥å‰ç½®æ¡ä»¶
    if not self._check_prerequisites(service_name):
        return ServiceResult(False, "å‰ç½®æ¡ä»¶ä¸æ»¡è¶³")
    
    # 3. å¯åŠ¨æœåŠ¡
    try:
        service = self._create_service(service_name)
        if service.start():
            self.services[service_name] = service
            return ServiceResult(True, f"{service_name}å¯åŠ¨æˆåŠŸ")
        else:
            return ServiceResult(False, f"{service_name}å¯åŠ¨å¤±è´¥")
    except Exception as e:
        return ServiceResult(False, f"{service_name}å¯åŠ¨å¼‚å¸¸: {e}")
```

## ğŸŒ Web APIè®¾è®¡

### 1. æœåŠ¡æ§åˆ¶API
```python
# æœåŠ¡ç®¡ç†
POST /api/services/start          # å¯åŠ¨æœåŠ¡
POST /api/services/stop           # åœæ­¢æœåŠ¡
POST /api/services/restart        # é‡å¯æœåŠ¡
GET  /api/services/status         # è·å–æœåŠ¡çŠ¶æ€
GET  /api/services/list           # è·å–æœåŠ¡åˆ—è¡¨

# ç³»ç»Ÿç®¡ç†
POST /api/system/start            # å¯åŠ¨ç³»ç»Ÿ
POST /api/system/stop             # åœæ­¢ç³»ç»Ÿ
POST /api/system/mode             # åˆ‡æ¢è¿è¡Œæ¨¡å¼
GET  /api/system/status           # è·å–ç³»ç»ŸçŠ¶æ€
```

### 2. ç­–ç•¥ç®¡ç†API
```python
# ç­–ç•¥æ§åˆ¶
GET  /api/strategies/list         # è·å–ç­–ç•¥åˆ—è¡¨
GET  /api/strategies/current      # è·å–å½“å‰ç­–ç•¥
POST /api/strategies/switch       # åˆ‡æ¢ç­–ç•¥
POST /api/strategies/pause        # æš‚åœç­–ç•¥
POST /api/strategies/resume       # æ¢å¤ç­–ç•¥

# ç­–ç•¥é…ç½®
GET  /api/strategies/{name}/config    # è·å–ç­–ç•¥é…ç½®
POST /api/strategies/{name}/config    # æ›´æ–°ç­–ç•¥é…ç½®
GET  /api/strategies/{name}/stats     # è·å–ç­–ç•¥ç»Ÿè®¡
```

### 3. æ•°æ®æŸ¥è¯¢API
```python
# è¡Œæƒ…æ•°æ®
GET  /api/market/ticks            # è·å–å®æ—¶è¡Œæƒ…
GET  /api/market/klines           # è·å–Kçº¿æ•°æ®
GET  /api/market/symbols          # è·å–åˆçº¦åˆ—è¡¨

# è´¦æˆ·æ•°æ®
GET  /api/account/info            # è·å–è´¦æˆ·ä¿¡æ¯
GET  /api/account/positions       # è·å–æŒä»“ä¿¡æ¯
GET  /api/account/orders          # è·å–è®¢å•ä¿¡æ¯
GET  /api/account/trades          # è·å–æˆäº¤ä¿¡æ¯

# é£æ§æ•°æ®
GET  /api/risk/metrics            # è·å–é£é™©æŒ‡æ ‡
GET  /api/risk/limits             # è·å–é£æ§é™åˆ¶
POST /api/risk/limits             # æ›´æ–°é£æ§é™åˆ¶
```

### 4. å®æ—¶é€šä¿¡API
```python
# WebSocketè¿æ¥
WS   /ws/market                   # å®æ—¶è¡Œæƒ…æ¨é€
WS   /ws/account                  # è´¦æˆ·å˜åŠ¨æ¨é€
WS   /ws/orders                   # è®¢å•çŠ¶æ€æ¨é€
WS   /ws/system                   # ç³»ç»ŸçŠ¶æ€æ¨é€
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### å®æ—¶æ•°æ®æµ
```
CTP Gateway â†’ æ ¸å¿ƒæœåŠ¡ â†’ æ•°æ®ç¼“å­˜ â†’ WebSocket â†’ Webç•Œé¢
```

### æ§åˆ¶æŒ‡ä»¤æµ
```
Webç•Œé¢ â†’ HTTP API â†’ main.py â†’ æ ¸å¿ƒæœåŠ¡ â†’ CTP Gateway
```

### çŠ¶æ€åŒæ­¥æµ
```
æ ¸å¿ƒæœåŠ¡ â†â†’ main.py â†â†’ Webç•Œé¢
```

## ğŸ”„ æœåŠ¡ä¾èµ–å…³ç³»

### ä¾èµ–å›¾
```
CTP Gateway (åŸºç¡€)
    â†“
MarketDataService â† CTP Gateway (å¿…é¡»)
AccountService â† CTP Gateway (å¿…é¡»)
    â†“
RiskService â† AccountService (å¿…é¡»)
    â†“
TradingService â† MarketDataService + AccountService + RiskService + CTP Gateway (å…¨éƒ¨å¿…é¡»)
```

### å¯åŠ¨é¡ºåº
```
1. ConfigManager
2. CTP Gateway
3. EventEngine
4. MarketDataService
5. AccountService (å¦‚æœæœ‰äº¤æ˜“è¿æ¥)
6. RiskService (å¦‚æœAccountServiceæˆåŠŸ)
7. TradingService (å¦‚æœæ‰€æœ‰å‰ç½®æœåŠ¡æˆåŠŸ)
```

## ğŸ¯ è¿è¡Œæ¨¡å¼è®¾è®¡

### æ¨¡å¼å®šä¹‰
- **FULL_TRADING**: å®Œæ•´äº¤æ˜“æ¨¡å¼ - æ‰€æœ‰æœåŠ¡æ­£å¸¸
- **MONITOR_ONLY**: ä»…ç›‘æ§æ¨¡å¼ - æœ‰è¡Œæƒ…å’Œè´¦æˆ·ï¼Œæ— äº¤æ˜“
- **MARKET_DATA_ONLY**: ä»…è¡Œæƒ…æ¨¡å¼ - åªæœ‰è¡Œæƒ…æ•°æ®

### æ¨¡å¼åˆ‡æ¢
ç”¨æˆ·å¯ä»¥é€šè¿‡Webç•Œé¢ä¸»åŠ¨åˆ‡æ¢è¿è¡Œæ¨¡å¼ï¼Œç³»ç»Ÿä¹Ÿä¼šæ ¹æ®æœåŠ¡çŠ¶æ€è‡ªåŠ¨è°ƒæ•´æ¨¡å¼ã€‚

## ğŸ“ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„é‡æ„
1. é‡æ„main.pyä¸ºæœåŠ¡å®¹å™¨
2. è®¾è®¡Webæ§åˆ¶API
3. å®ç°åŸºç¡€çš„æœåŠ¡æ§åˆ¶åŠŸèƒ½

### ç¬¬äºŒé˜¶æ®µï¼šWebç•Œé¢å¼€å‘
1. å¼€å‘ç³»ç»Ÿæ§åˆ¶å°
2. å®ç°å®æ—¶ç›‘æ§ç•Œé¢
3. é›†æˆæ•°æ®å±•ç¤ºåŠŸèƒ½

### ç¬¬ä¸‰é˜¶æ®µï¼šç­–ç•¥ç®¡ç†
1. å®ç°ç­–ç•¥åˆ‡æ¢åŠŸèƒ½
2. å¼€å‘ç­–ç•¥é…ç½®ç•Œé¢
3. é›†æˆç­–ç•¥åˆ†æåŠŸèƒ½

### ç¬¬å››é˜¶æ®µï¼šæ•°æ®åˆ†æ
1. å®ç°å†å²æ•°æ®åˆ†æ
2. å¼€å‘æŠ¥è¡¨ç”ŸæˆåŠŸèƒ½
3. å®Œå–„æ•°æ®å¯è§†åŒ–

## ğŸ”’ å®‰å…¨è€ƒè™‘

### è®¿é—®æ§åˆ¶
- ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- æ“ä½œæƒé™åˆ†çº§
- æ•æ„Ÿæ“ä½œç¡®è®¤

### æ“ä½œå®¡è®¡
- å®Œæ•´çš„æ“ä½œæ—¥å¿—
- ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
- ç³»ç»Ÿå˜æ›´è®°å½•

### æ•°æ®å®‰å…¨
- æ•æ„Ÿæ•°æ®åŠ å¯†
- å®‰å…¨çš„APIé€šä¿¡
- æ•°æ®å¤‡ä»½å’Œæ¢å¤

---

**ä¸‹ä¸€æ­¥**: åŸºäºæ­¤è®¾è®¡æ–‡æ¡£ï¼Œå¼€å§‹å®æ–½ç¬¬ä¸€é˜¶æ®µçš„æ¶æ„é‡æ„å·¥ä½œã€‚
